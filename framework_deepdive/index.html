
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Splunk">
      
      
        <link rel="canonical" href="https://splunk.github.io/addonfactory-ucc-test/framework_deepdive/">
      
      
        <link rel="prev" href="../troubleshooting/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.2.7">
    
    
      
        <title>Framework deepdive - AUT Framework</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.046329b4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="orange">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#framework-deep-dive" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <!-- Source:
https://github.com/squidfunk/mkdocs-material/blob/master/src/templates/partials/header.html
-->



  


<!-- Header -->
<header class="md-header md-header--shadow" data-md-component="header">
  <nav
    class="md-header__inner md-grid"
    aria-label="Header"
  >

    <!-- Link to home -->
    <a
      href=".."
      title="AUT Framework"
      class="md-header__button md-logo"
      aria-label="AUT Framework"
      data-md-component="logo"
    >
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>

    <!-- Button to open drawer -->
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AUT Framework
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Framework deepdive
            
          </span>
        </div>
      </div>
    </div>

    
      <a href="../print_page/" title="Print Site" class="md-header__button md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 3H6v4h12m1 5a1 1 0 0 1-1-1 1 1 0 0 1 1-1 1 1 0 0 1 1 1 1 1 0 0 1-1 1m-3 7H8v-5h8m3-6H5a3 3 0 0 0-3 3v6h4v4h12v-4h4v-6a3 3 0 0 0-3-3Z"/></svg>
      </a>
    

    <!-- Color palette toggle -->
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    

    <!-- User preference: color palette -->
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    

    <!-- Site language selector -->
    

    <!-- Button to open search modal -->
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>

      <!-- Search interface -->
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <!-- Repository information -->
    
      <div class="md-header__source">
        <a href="https://github.com/splunk/addonfactory-ucc-test" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Splunk Add-on AUT Framework
  </div>
</a>
      </div>
    
  </nav>

  <!-- Navigation tabs (sticky) -->
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="AUT Framework" class="md-nav__button md-logo" aria-label="AUT Framework" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    AUT Framework
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/splunk/addonfactory-ucc-test" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Splunk Add-on AUT Framework
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About AUT
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../hello_world/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hello World
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../design_principles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Design Principles
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../test_scenarios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Scenarios
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../before_you_write_your_first_line_of_code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Before you write your first line of code
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../when_you_write_your_tests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    When you write your tests
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../ucc-test-modinput_cli_tool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ucc-test-modinput CLI tool
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../addonfactory-ucc-test_pytest_plugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    addonfactory-ucc-test pytest plugin
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../CHANGELOG/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Framework deepdive
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Framework deepdive
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#framework-philosophy" class="md-nav__link">
    Framework philosophy
  </a>
  
    <nav class="md-nav" aria-label="Framework philosophy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#popular-add-on-test-scenarios" class="md-nav__link">
    Popular add-on test scenarios
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-requirements" class="md-nav__link">
    Test requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framework-requirements" class="md-nav__link">
    Framework requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framework-basic-concepts" class="md-nav__link">
    Framework basic concepts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#framework-structure-and-entities" class="md-nav__link">
    Framework structure and entities
  </a>
  
    <nav class="md-nav" aria-label="Framework structure and entities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#splunk-client" class="md-nav__link">
    Splunk client
  </a>
  
    <nav class="md-nav" aria-label="Splunk client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#splunk-client-class" class="md-nav__link">
    Splunk client class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splunk-functionality-supported-out-of-the-box" class="md-nav__link">
    Splunk functionality supported out of the box.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-on-api-endpoint-support" class="md-nav__link">
    Add-on API endpoint support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-configuration-class" class="md-nav__link">
    Client configuration class
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splunk-client-and-configuration-classes-binding-decorators" class="md-nav__link">
    Splunk Client and configuration classes binding decorators
  </a>
  
    <nav class="md-nav" aria-label="Splunk Client and configuration classes binding decorators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#register_splunk_classswagger_client-splunk_configuration_class" class="md-nav__link">
    register_splunk_class(swagger_client, splunk_configuration_class)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define_splunk_client_argumentswagger_client-splunk_client_class-splunk_class_argument_name" class="md-nav__link">
    define_splunk_client_argument(swagger_client, splunk_client_class, splunk_class_argument_name)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vendor-client" class="md-nav__link">
    Vendor client
  </a>
  
    <nav class="md-nav" aria-label="Vendor client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vendor-client-class" class="md-nav__link">
    Vendor client class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-class" class="md-nav__link">
    Configuration class
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-classes-register-decorators" class="md-nav__link">
    Client classes register decorators
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forges" class="md-nav__link">
    Forges
  </a>
  
    <nav class="md-nav" aria-label="Forges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#forge-function-arguments" class="md-nav__link">
    Forge function arguments
  </a>
  
    <nav class="md-nav" aria-label="Forge function arguments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#builtin-arguments-reserved-argument-names" class="md-nav__link">
    Builtin arguments (reserved argument names)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forges-as-regular-functions" class="md-nav__link">
    Forges as regular functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forges-as-generators-functions" class="md-nav__link">
    Forges as generators functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#artifactory" class="md-nav__link">
    Artifactory
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forge-assignment-scope" class="md-nav__link">
    Forge assignment scope
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forge-assignment" class="md-nav__link">
    Forge assignment
  </a>
  
    <nav class="md-nav" aria-label="Forge assignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#helper-data-collection-classes" class="md-nav__link">
    Helper data collection classes
  </a>
  
    <nav class="md-nav" aria-label="Helper data collection classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#forge-helper-data-collection-class" class="md-nav__link">
    forge helper data collection class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forges-helper-data-collection-class" class="md-nav__link">
    forges helper data collection class
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forge-assignment-decorators" class="md-nav__link">
    Forge assignment decorators
  </a>
  
    <nav class="md-nav" aria-label="Forge assignment decorators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bootstrap-decorator" class="md-nav__link">
    bootstrap decorator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attach-decorator" class="md-nav__link">
    attach decorator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-using-bootstrap-and-attach-decorators-together-with-the-same-test" class="md-nav__link">
    When using bootstrap and attach decorators together with the same test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#support-for-parametrized-test-arguments" class="md-nav__link">
    Support for parametrized test arguments
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#probes" class="md-nav__link">
    Probes
  </a>
  
    <nav class="md-nav" aria-label="Probes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#probe-as-function" class="md-nav__link">
    Probe as function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#probe-as-generator-function" class="md-nav__link">
    Probe as generator function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-search-probe-as-generator-function" class="md-nav__link">
    Helper search probe as generator function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#probe-arguments-and-return-value" class="md-nav__link">
    Probe arguments and return value
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    Test
  </a>
  
    <nav class="md-nav" aria-label="Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-execution-order" class="md-nav__link">
    Test execution order
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-arguments" class="md-nav__link">
    Test arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks" class="md-nav__link">
    Tasks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forge-execution-flow-and-resource-lifetime-diagram" class="md-nav__link">
    Forge execution flow and resource lifetime diagram
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    Best practices
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#troubleshooting-resources" class="md-nav__link">
    Troubleshooting resources
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#log-file-splunk-add-on-ucc-modinput-test-functionallog" class="md-nav__link">
    Log file splunk-add-on-ucc-modinput-test-functional.log
  </a>
  
    <nav class="md-nav" aria-label="Log file splunk-add-on-ucc-modinput-test-functional.log">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#informational-log-examples" class="md-nav__link">
    Informational log examples
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-log-examples" class="md-nav__link">
    Error log examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log-file-ucc_modinput_testlog" class="md-nav__link">
    Log file ucc_modinput_test.log
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framework-sequential-execution-mode" class="md-nav__link">
    Framework sequential execution mode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-issues-and-troubleshooting" class="md-nav__link">
    Sample issues and troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Sample issues and troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#assertion-attempt-to-assign-the-same-forge-multiply-times-or-duplicated-test-name" class="md-nav__link">
    Assertion "Attempt to assign the same forge multiply times or duplicated test name"
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#framework-philosophy" class="md-nav__link">
    Framework philosophy
  </a>
  
    <nav class="md-nav" aria-label="Framework philosophy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#popular-add-on-test-scenarios" class="md-nav__link">
    Popular add-on test scenarios
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-requirements" class="md-nav__link">
    Test requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framework-requirements" class="md-nav__link">
    Framework requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framework-basic-concepts" class="md-nav__link">
    Framework basic concepts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#framework-structure-and-entities" class="md-nav__link">
    Framework structure and entities
  </a>
  
    <nav class="md-nav" aria-label="Framework structure and entities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#splunk-client" class="md-nav__link">
    Splunk client
  </a>
  
    <nav class="md-nav" aria-label="Splunk client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#splunk-client-class" class="md-nav__link">
    Splunk client class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splunk-functionality-supported-out-of-the-box" class="md-nav__link">
    Splunk functionality supported out of the box.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-on-api-endpoint-support" class="md-nav__link">
    Add-on API endpoint support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-configuration-class" class="md-nav__link">
    Client configuration class
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splunk-client-and-configuration-classes-binding-decorators" class="md-nav__link">
    Splunk Client and configuration classes binding decorators
  </a>
  
    <nav class="md-nav" aria-label="Splunk Client and configuration classes binding decorators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#register_splunk_classswagger_client-splunk_configuration_class" class="md-nav__link">
    register_splunk_class(swagger_client, splunk_configuration_class)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define_splunk_client_argumentswagger_client-splunk_client_class-splunk_class_argument_name" class="md-nav__link">
    define_splunk_client_argument(swagger_client, splunk_client_class, splunk_class_argument_name)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vendor-client" class="md-nav__link">
    Vendor client
  </a>
  
    <nav class="md-nav" aria-label="Vendor client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vendor-client-class" class="md-nav__link">
    Vendor client class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-class" class="md-nav__link">
    Configuration class
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-classes-register-decorators" class="md-nav__link">
    Client classes register decorators
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forges" class="md-nav__link">
    Forges
  </a>
  
    <nav class="md-nav" aria-label="Forges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#forge-function-arguments" class="md-nav__link">
    Forge function arguments
  </a>
  
    <nav class="md-nav" aria-label="Forge function arguments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#builtin-arguments-reserved-argument-names" class="md-nav__link">
    Builtin arguments (reserved argument names)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forges-as-regular-functions" class="md-nav__link">
    Forges as regular functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forges-as-generators-functions" class="md-nav__link">
    Forges as generators functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#artifactory" class="md-nav__link">
    Artifactory
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forge-assignment-scope" class="md-nav__link">
    Forge assignment scope
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forge-assignment" class="md-nav__link">
    Forge assignment
  </a>
  
    <nav class="md-nav" aria-label="Forge assignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#helper-data-collection-classes" class="md-nav__link">
    Helper data collection classes
  </a>
  
    <nav class="md-nav" aria-label="Helper data collection classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#forge-helper-data-collection-class" class="md-nav__link">
    forge helper data collection class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forges-helper-data-collection-class" class="md-nav__link">
    forges helper data collection class
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forge-assignment-decorators" class="md-nav__link">
    Forge assignment decorators
  </a>
  
    <nav class="md-nav" aria-label="Forge assignment decorators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bootstrap-decorator" class="md-nav__link">
    bootstrap decorator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attach-decorator" class="md-nav__link">
    attach decorator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-using-bootstrap-and-attach-decorators-together-with-the-same-test" class="md-nav__link">
    When using bootstrap and attach decorators together with the same test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#support-for-parametrized-test-arguments" class="md-nav__link">
    Support for parametrized test arguments
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#probes" class="md-nav__link">
    Probes
  </a>
  
    <nav class="md-nav" aria-label="Probes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#probe-as-function" class="md-nav__link">
    Probe as function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#probe-as-generator-function" class="md-nav__link">
    Probe as generator function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-search-probe-as-generator-function" class="md-nav__link">
    Helper search probe as generator function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#probe-arguments-and-return-value" class="md-nav__link">
    Probe arguments and return value
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    Test
  </a>
  
    <nav class="md-nav" aria-label="Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-execution-order" class="md-nav__link">
    Test execution order
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-arguments" class="md-nav__link">
    Test arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks" class="md-nav__link">
    Tasks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forge-execution-flow-and-resource-lifetime-diagram" class="md-nav__link">
    Forge execution flow and resource lifetime diagram
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    Best practices
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#troubleshooting-resources" class="md-nav__link">
    Troubleshooting resources
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#log-file-splunk-add-on-ucc-modinput-test-functionallog" class="md-nav__link">
    Log file splunk-add-on-ucc-modinput-test-functional.log
  </a>
  
    <nav class="md-nav" aria-label="Log file splunk-add-on-ucc-modinput-test-functional.log">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#informational-log-examples" class="md-nav__link">
    Informational log examples
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-log-examples" class="md-nav__link">
    Error log examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log-file-ucc_modinput_testlog" class="md-nav__link">
    Log file ucc_modinput_test.log
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framework-sequential-execution-mode" class="md-nav__link">
    Framework sequential execution mode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-issues-and-troubleshooting" class="md-nav__link">
    Sample issues and troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Sample issues and troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#assertion-attempt-to-assign-the-same-forge-multiply-times-or-duplicated-test-name" class="md-nav__link">
    Assertion "Attempt to assign the same forge multiply times or duplicated test name"
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="framework-deep-dive">Framework deep dive<a class="headerlink" href="#framework-deep-dive" title="Permanent link">&para;</a></h1>
<p><em>Not yet finished, writing is still in progress &hellip;</em></p>
<h2 id="framework-philosophy">Framework philosophy<a class="headerlink" href="#framework-philosophy" title="Permanent link">&para;</a></h2>
<p>This section explains the background why this framework was created, what it tries to solve and what ideas it implements</p>
<h3 id="popular-add-on-test-scenarios">Popular add-on test scenarios<a class="headerlink" href="#popular-add-on-test-scenarios" title="Permanent link">&para;</a></h3>
<p>Spunk technical add-on is an application which goal is to interact with vendor customer environment in order to pull required vendor specific data and then send it to Splunk environment to be ingested and saved in desired Splunk indexes. This makes functional testing of add-ons to stick to a couple of common test scenarios:</p>
<ol>
<li>Test of Add-on configuration validators: </li>
</ol>
<ul>
<li>
<p>interact with add-on API endpoint trying to configure various add-on supported objects (inputs and supporting configuration files) using incorrect values</p>
</li>
<li>
<p>expecting that corresponding API endpoint rejects these values with expected explanatory error message in response and proper error logged.</p>
</li>
<li>
<p>Delete configuration and objects created for test from Splunk instance.</p>
</li>
</ul>
<p>For example, test can try to configure add-on proxy configuration using unsupported port number and expect that proxy will not be configured and the endpoint responses with an error message clearly pointing to unsupported port number.</p>
<ol start="2">
<li>Data ingestion validation:</li>
</ol>
<ul>
<li>
<p>interact with customer environment to apply configurations, create objects or reproduce user actions in order to recreate conditions making desired vendor specific data to appear and ready for pulling to Splunk.</p>
</li>
<li>
<p>interact with add-on at Splunk instance to apply configurations and create objects in order engage required add-on modular input to ingest data created for it in customer environment.</p>
</li>
<li>
<p>validate ingestion by interacting with Splunk services to makes sure that expected number of events of expected type have been ingested as well as make sure that add-on modular input did not log any error messages during ingestion process.</p>
</li>
<li>
<p>Delete configuration and objects created for test from customer environment and Splunk instance.</p>
</li>
</ul>
<p>For example, functional test may verify correct ingestion of data from AWS S3 bucket which may require to configure S3 bucket and upload a data file prepared for test, configure corresponding input the way it would point to correct resource at created S3 bucket, let this input to run and ingest expected data, execute Splunk searches to confirm the number and sourcetypes of ingested events are correct, execute Splunk searches to make sure input did not log any error messages during ingestion process.</p>
<h3 id="test-requirements">Test requirements<a class="headerlink" href="#test-requirements" title="Permanent link">&para;</a></h3>
<p>Based on the test scenarios and examples listed above it is clear that for each add-on functional test before actual verification developer should deal with preparing test requirements, i.e. creation of necessary resources at Splunk or vendor related environment - objects and configurations, possibly uploading some test data. Next step is to retrieve some of test environment state properties and only then do the actual checks by comparing retrieved parameters values with expectations. Another thing to take care is to remove prepared resources after the test completion or at the end of test session. There are even more topics to think about connected with test execution optimization: for example, if several test can safely reuse the same resource it would be better to preserve this resource to let it be reused instead of creating and deleting it several times for each tests; or what if several resources for a tests are independent then it would be faster to create them in parallel. Taking care about such improvements makes tests better but at the same time adds complexity and may make them less clear and straightforward and less maintainable. Unified functional test framework was developed with desire make it take care about all the mentioned improvements while hiding from developers all related complexity and giving clear and straightforward way to create test and describe test requirements. </p>
<h3 id="framework-requirements">Framework requirements<a class="headerlink" href="#framework-requirements" title="Permanent link">&para;</a></h3>
<p>To address the challenges listed above, several core requirements have been developed to be implemented by the framework:</p>
<ol>
<li>
<p>Framework should provide a declaration way of describing test requirements (resources required for tests) outside the test function body.</p>
</li>
<li>
<p>Test requirements should be provided in same area as the tests function they belong to and give clear understanding what resources are needed, and in what order they should be created. </p>
</li>
<li>
<p>Test itself should be as small as possible and only contain as much code as needed for verifications (assert statements) and optionally the code to collect data needed for verifications.</p>
</li>
<li>
<p>Dependencies between resources should be declared as a flat list in contrast to recursive approach where code creating resource also creates all resources it depends on which increases code complexity and hides dependencies from developer potentially making the code difficult to understand and support.</p>
</li>
<li>
<p>Developer should be able to specify if some resources can be created in parallel.</p>
</li>
<li>
<p>Developer should be able to specify what resources can be created in advance and what should be created right before test execution.</p>
</li>
<li>
<p>Framework should understand lifetime of a resource and execute code removing the resource as soon as all tests using it are executed. Developer should have a way to alter default framework behavior for specific tests.</p>
</li>
<li>
<p>Developer should be able to specify conditions for certain resources that can be used by framework to confirm that this resource is created or to wait for this resource to be created during required time.</p>
</li>
</ol>
<h3 id="framework-basic-concepts">Framework basic concepts<a class="headerlink" href="#framework-basic-concepts" title="Permanent link">&para;</a></h3>
<p>To address the above requirements framework introduces a concept of forges - reusable functions responsible for creation and optionally deletion of required resources. They are implemented by developer separately from tests and bound to test functions using &lsquo;bootstrap&rsquo; or &lsquo;attach&rsquo; decorators. The order in which forges are listed within decorators defines the dependencies between forges. In other words, forge declared earlier becomes a prerequisite for a forge declared later. As a result framework will make sure that dependent forge is executed after its dependency. If two or more forges do not depend on each other, they can be declared in the same &ldquo;line&rdquo; or block of forges which would tell framework to execute these forges in parallel if possible. </p>
<p>Forges can accept data via function arguments. The values for those arguments can be defined by a user explicitly or via parametrized arguments when declaring a forge as test requirement. Another way for a forge to receive argument values is to collect them from test artifactory. Artifactory is an internal storage of key-value pairs maintained for each test function separately. The mapping of values from artifactory to forge arguments is done by framework automatically by arguments names. Forges can update artifactory values or create new ones through returned or yielded values. </p>
<p>When forge function is assigned to a specific tests it will receive argument values specific for this test that may be the same or differ from other test. Depending on argument values the results of forge executions also can be the same or different. In some sense one can think about assigned forge as about a <code>task</code> that creates a resource or fulfills an action. Framework assumes that forge functions is not affected by any any side values or processes, which means that executing the same forge function with the same argument values should results in the same action taken or in the same resource created. Based on this, same forge executed twice with different argument values is treated by framework as two different <code>tasks</code> while when executed with the same argument values will be treated as the same <code>task</code> creating the same resource and by default framework will try to skip unnecessary executions. Internally framework operates with tasks entities that are combinations of a forge function with specific argument values and optionally attached probe and  assigned to a specific test, however developer does not deal with tasks objects directly. </p>
<p>When assigning a forge to a test, one of two additional properties that developer can configuration is &ldquo;probe&rdquo;. Probe property allows to attach a probe function that will be used by framework to make sure that action taken by forge indeed has expected result, i.e. a resource has been created or a specific configuration has been applied. Framework will be invoking probe function with certain interval until probe gets successful or time given for probe to success expires. Just like forges probe functions can access test artifactory variables via declared function arguments. Last boolean value returned by a probe will be added by framework to the test artifactory with the name of probe function as the property name so the test function will be able to verify if the probe was successful or exited because of timeout.</p>
<p>Scope is the second of the two arguments that forge can accept when assigned to a tests. Before forge function execution framework pays attention to forge function name, forge function arguments values and forge scope. If there several tests that have the same forge with the same scope assigned to them and those forges have the same call argument values, framework assumes it is the same forge (or forge represents the same task) dedicated to create the same resource and executes it only once. By default all forges have &ldquo;session&rdquo; scope which means this comparison will take place across all the executed tests.  Changing scope value at forge assignment to tests allows to narrow the scope of tests for which forge execution results may be reused, for example to all tests in the same module or to a single test. Note that as soon as the last test using forge is executed, framework invokes teardown code of the forge if such code was implemented by developer.</p>
<p>It is also important which of the two decorators are used to assign forge to a test. Bootstrap decorator assumes that forge should create resource before executing tests. All forges assigned to different tests taken as independent and executed in parallel - first go all forges at bootstrap list top, then all in the second place and so on. Attach decorator works differently - it invokes forges right before the test execution. Bootstrap is more preferable way to execute forges to achieve better tests execution times, but it requires from developer more efforts to make sure that forges of different tests do not compete for configuring the same resource. There are some cases where it&rsquo;s possible to avoid this competition, for example when dealing with global or single instance resources like testing different proxy configurations. In those cases it&rsquo;s important to apply each specific configuration right before execution of (i.e. specifically for) related test function and &lsquo;attach&rsquo; decorator is the proper way to do this.</p>
<p>It is important to mention that framework also allows tests to receive (or subscribe for) test artifactory properties generated during forge executions just by using their names to test function argument list. This way forges and probes can prepare some useful values in test artifactory and let test to use them for necessary verifications. </p>
<p>In some sense forges and pytest fixtures have a lot in common, however they are very different in one important way - the way of organizing dependencies between them. To make a fixture A to depend on results of fixture B, fixture B should be declared as argument of fixture A.  Implemented this way, the relationship between fixture A and fixture B are hardcoded and B cannot be replaced with another fixture that would generate expected output using different source data or algorithm. When fixture A is used in tests, its dependencies are hidden from developer, and to understand what fixture A does, developer should study its dependency B as well, and inside be he may discover other dependencies and so on. In big test projects relationship between fixtures can become pretty sophisticated. Forges dependencies, in contrast, are dynamic and rely on artifactory variables provided by dependency forges, that allows to recombine forges according to desired test scenario and taking into account arguments expected by the forge function and generated by it artifacts. When talking about declaring test dependencies, they all (test dependencies together with forges dependencies) are declared in a form of a flat list located right before test function that gives to developer a clear picture about test requirements, i.e. resources to be created for the test execution.</p>
<h2 id="framework-structure-and-entities">Framework structure and entities<a class="headerlink" href="#framework-structure-and-entities" title="Permanent link">&para;</a></h2>
<p>Framework is created as pytest plugin and relays on pytest mechanisms of tests execution. Above pytest functionality framework collects information about required forges, tries to execute them optimally respecting defined dependencies and making sure that corresponding tests are not executed before all declared by developer requirements are met.</p>
<p><img alt="image" src="../images/framework_components.jpg" /></p>
<h3 id="splunk-client">Splunk client<a class="headerlink" href="#splunk-client" title="Permanent link">&para;</a></h3>
<p>Splunk client is a combination of two classes - client class, responsible for interactions with Splunk environment, and configuration class, responsible for providing necessary settings for client class to act and some test data and settings for forge, probe and test functions. This separation is chosen to make it possible to apply different configuration to the same client class and let it communicate with different Splunk instances or point to different test samples and so on. Using provided client and configuration classes framework creates a separate instance of client class for each test and make it available to forge, probe and test functions via internally supported function arguments.</p>
<h4 id="splunk-client-class">Splunk client class<a class="headerlink" href="#splunk-client-class" title="Permanent link">&para;</a></h4>
<p>Splunk client class is supposed to implement methods providing access to Splunk and add-on specific API. This client class is what developer deals with through framework supported function argument <code>splunk_client</code> when implementing framework entities like forges, probes and tests themselves. Developer can use either default client class available out of the box or extend it with add-on API support as well as with custom methods to add support for Splunk related functionality not supported by the framework. Framework tries to save developers&rsquo; efforts by automating the creation of splunk client class when developer executes framework <code>init</code> and <code>gen</code> commands. These commands use openapi.json file generated by UCC while building TA package to create swagger support classes for add-on API endpoints. Then, based on swagger classes, framework generates a new managed client class inherited from framework base client class. At the same time framework generates one more &ldquo;developer facing&rdquo; client class inherited from the managed client class. By doing this framework adds support for add-on API and also prepares area for developers&rsquo; custom code extensions.</p>
<h4 id="splunk-functionality-supported-out-of-the-box">Splunk functionality supported out of the box.<a class="headerlink" href="#splunk-functionality-supported-out-of-the-box" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><em>splunk_client.instance_epoch_time()</em> - returns current time at splunk instance in epoch format</p>
</li>
<li>
<p><em>splunk_client.search(query)</em> - executes SPL search query at Splunk instance and returns result in SearchState class object (<em>splunk_add_on_ucc_modinput_test.common.splunk_instance.SearchState</em>)</p>
</li>
<li>
<p><em>splunk_client.create_index(name, datatype)</em> - creates Splunk index with a given name and data type (event or metric). Returns <em>splunklib.Index</em> object.</p>
</li>
<li>
<p><em>splunk_client.default_index()</em> - returns default Splunk index name if framework configured to create one.</p>
</li>
<li>
<p><em>splunk_client.search_probe(probe_spl, verify_fn, timeout, interval, probe_name)</em> - probe generator function to simplify creation of framework probes based on Splunk searches.</p>
</li>
<li>
<p><em>splunk_client.repeat_search_until(spl, condition_fn, timeout, interval)</em> - methods execution Splunk search continuously in defined intervals until it gets expected result or reaches timeout.</p>
</li>
<li>
<p><em>splunk_client.instance_file_helper()</em> - Factory method for SplunkInstanceFileHelper, allowing to execute some file operations directly on Splunk host. Requires <code>Splunk Add-on for Modinput Test</code> to be installed on the Splunk host. May be used for creation and verification of file based checkpoints. </p>
</li>
<li>
<p><em>splunk_client.app_file_helper()</em> - same as instance_file_helper except SplunkInstanceFileHelper (<em>splunk_add_on_ucc_modinput_test.functional.common.splunk_instance_file</em>) will treat provided file paths as relative to add-on root folder on Splunk host. Requires <code>app_name</code> property to be part of <code>splunk_client</code> configuration class.</p>
</li>
<li>
<p><em>splunk_client.kvstore_api_helper()</em> - Factory method for SplunkInstanceKVStoreAPI, allowing to execute api calls for KV store directly on Splunk host. Requires <code>app_name</code> and <code>app_user</code> properties to be part of splunk_client configuration class. It is used to get the record from KV store collection. </p>
</li>
</ul>
<h4 id="add-on-api-endpoint-support">Add-on API endpoint support<a class="headerlink" href="#add-on-api-endpoint-support" title="Permanent link">&para;</a></h4>
<p>Each technical add-on creates an additional set of API endpoints responsible for add-on resources like inputs, configuration files and custom rest handlers. 
As mentioned earlier framework <code>init</code> and <code>gen</code> commands </p>
<h4 id="client-configuration-class">Client configuration class<a class="headerlink" href="#client-configuration-class" title="Permanent link">&para;</a></h4>
<p>Client configuration class is a separate class dedicated to collect all settings for client class. Framework contains implementation of the base configuration class to collect settings for base client class functionality. Developer has an option to extend it by inheriting a new class form base configuration class and adding new properties as well as redefine values or sources of default properties. Framework <code>init</code> command generates default client configuration class that looks like the following
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">splunk_add_on_ucc_modinput_test.functional.splunk</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">SplunkConfigurationBase</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">class</span> <span class="nc">Configuration</span><span class="p">(</span><span class="n">SplunkConfigurationBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">customize_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># to be implemented</span>
        <span class="c1"># self.encoded_prop = utils.get_from_environment_variable(</span>
        <span class="c1">#     &quot;ENV_PROP_NAME1&quot;, string_function=utils.Base64.decode</span>
        <span class="c1"># )</span>
        <span class="c1"># self.not_encoded_prop = utils.get_from_environment_variable(</span>
        <span class="c1">#     &quot;ENV_PROP_NAME2&quot;</span>
        <span class="c1"># )</span>
        <span class="k">pass</span>
</code></pre></div>
As seen from the example, developer has to overwrite <code>customize_configuration</code> method to add additional configuration properties. This method is called from class __init__ method and added to simplify defining of new configuration properties by avoiding overwriting  __init__ method itself that requires some specific arguments expected by framework. </p>
<p>Collection of default framework properties is implemented through class methods listed below. If there is a need to alter values, sources or collection algorithms for some of these properties, corresponding methods should be overwritten.</p>
<ul>
<li>
<p><code>collect_host(cls) -&gt; str | None</code> - to collect Splunk host name. Default value source is environment variable MODINPUT_TEST_SPLUNK_HOST.</p>
</li>
<li>
<p><code>collect_port(cls) -&gt; str | None</code> - to collect Splunk host port. Default value source is environment variable MODINPUT_TEST_SPLUNK_PORT.</p>
</li>
<li>
<p><code>collect_username(cls) -&gt; str | None</code> - to collect Splunk user name. Default value source is environment variable MODINPUT_TEST_SPLUNK_USERNAME.</p>
</li>
<li>
<p><code>collect_password(cls) -&gt; str | None</code> - to collect Splunk user password. Default value source is environment variable MODINPUT_TEST_SPLUNK_PASSWORD_BASE64.</p>
</li>
<li>
<p><code>collect_splunk_dedicated_index(cls) -&gt; str | None</code> - to collect name of existing Splunk index. Default value source is environment variable MODINPUT_TEST_SPLUNK_DEDICATED_INDEX.</p>
</li>
<li>
<p><code>collect_splunk_token(cls, is_optional: bool) -&gt; str | None</code> - to collect Splunk token. Default value source is environment variable MODINPUT_TEST_SPLUNK_TOKEN_BASE64.</p>
</li>
<li>
<p><code>collect_acs_server(cls, is_optional: bool) -&gt; str | None</code> - to collect Splunk ACS service url. Default value source is environment variable MODINPUT_TEST_ACS_SERVER.</p>
</li>
<li>
<p><code>collect_acs_stack(cls, is_optional: bool) -&gt; str | None</code> - to collect Splunk CS stack. Default value source is environment variable MODINPUT_TEST_ACS_STACK.</p>
</li>
</ul>
<p>Note that <code>is_optional</code> is boolean argument tells method if property is treated as optional or mandatory. If property is mandatory and method fails to collect value it should log a critical error and raise SplunkClientConfigurationException exception (<em>splunk_add_on_ucc_modinput_test.common.utils</em>). 
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Configuration</span><span class="p">(</span><span class="n">SplunkConfigurationBase</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">collect_host</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">code</span> <span class="n">to</span> <span class="n">provide</span> <span class="n">the</span> <span class="n">value</span><span class="o">&gt;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">collect_acs_server</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">is_optional</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">code</span> <span class="n">to</span> <span class="n">provide</span> <span class="n">the</span> <span class="n">value</span><span class="o">&gt;</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_optional</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Your error message&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">SplunkClientConfigurationException</span><span class="p">()</span>
</code></pre></div>
Beside default framework properties, configuration class gives access to command argument values defined for pytest executions via properties: <code>probe_invoke_interval</code>, <code>probe_wait_timeout</code>, <code>do_not_fail_with_teardown</code> and so on. It&rsquo;s easy to guess any property name for any argument by removing from argument name leading dashes and replacing internal dashes with underscores, for example <code>--bootstrap-wait-timeout</code> argument name turns to <code>bootstrap_wait_timeout</code> property name.</p>
<h3 id="splunk-client-and-configuration-classes-binding-decorators">Splunk Client and configuration classes binding decorators<a class="headerlink" href="#splunk-client-and-configuration-classes-binding-decorators" title="Permanent link">&para;</a></h3>
<p>When custom Splunk client and configuration classes are implemented there is one more step to be done to let framework know about these classes and use them. This can be done by using one of the decorators: <code>register_splunk_class</code> or <code>define_splunk_client_argument</code>. </p>
<h4 id="register_splunk_classswagger_client-splunk_configuration_class">register_splunk_class(swagger_client, splunk_configuration_class)<a class="headerlink" href="#register_splunk_classswagger_client-splunk_configuration_class" title="Permanent link">&para;</a></h4>
<p>This decorator should be applied to the Splunk client class created by a developer. It takes imported swagger client module as the first argument and binds it to client. Second argument is Splunk client configuration class implemented by developer. Decorator registers it in framework together with the Splunk client class. Usage of this decorator may look as the following
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">swagger_client</span>

<span class="k">class</span> <span class="nc">Configuration</span><span class="p">(</span><span class="n">SplunkConfigurationBase</span><span class="p">):</span>
    <span class="c1"># your configuration class implementation</span>

<span class="nd">@register_splunk_class</span><span class="p">(</span><span class="n">swagger_client</span><span class="p">,</span> <span class="n">Configuration</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">SplunkClient</span><span class="p">(</span><span class="n">ManagedSplunkClient</span><span class="p">):</span>
    <span class="c1"># code extending base Splunk client class</span>
</code></pre></div>
Having both classes registered, framework is capable to create instances of Splunk client classes with configuration class assigned to the instance and make it available via splunk_client builtin function argument in forges, probes and tests. 
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">my_forge</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">:</span> <span class="n">SplunkClient</span><span class="p">):</span>
    <span class="n">splunk_client</span><span class="o">.</span><span class="n">some_splunk_client_method</span><span class="p">()</span> <span class="c1"># some splunk client class method (exact name depends on the class implementation)</span>
</code></pre></div></p>
<p>The idea behind implementing client and configuration classes separately is to make it possible to use Splunk client class with different configurations. This may be useful to give tests access to several Splunk instances, for example, to execute comparative verifications of different Splunk and/or add-on versions. For this framework has another decorator that allows to register Splunk client class multiply times with different configuration classes.</p>
<h4 id="define_splunk_client_argumentswagger_client-splunk_client_class-splunk_class_argument_name">define_splunk_client_argument(swagger_client, splunk_client_class, splunk_class_argument_name)<a class="headerlink" href="#define_splunk_client_argumentswagger_client-splunk_client_class-splunk_class_argument_name" title="Permanent link">&para;</a></h4>
<p>In contrast to <code>register_splunk_class</code>, this decorator must be applied to a configuration class. It takes imported swagger client module as the first argument and binds it to client class specified in the second decorator argument. Last decorator argument is optional and allows to define new builtin framework argument name for the pair of client and configuration classes. By default this argument has value &lsquo;splunk_client&rsquo; so leaving it unspecified allows to overwrite binding to default builtin argument - when used this way both decorators work identically. However, defining different value will create a new builtin variable for specified combination of splunk client and configuration classes. Note that <code>splunk_class_argument_name</code> value when specified should comply with python rules of variable naming.
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">swagger_client</span>

<span class="k">class</span> <span class="nc">SplunkClient</span><span class="p">(</span><span class="n">ManagedSplunkClient</span><span class="p">):</span>
    <span class="c1"># code extending base Splunk client class</span>

<span class="nd">@splunk_class_argument_name</span><span class="p">(</span><span class="n">swagger_client</span><span class="p">,</span> <span class="n">SplunkClient</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ConfigurationSplunk9</span><span class="p">(</span><span class="n">SplunkConfigurationBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">customize_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define configuration to access Splunk v9 instance</span>

<span class="nd">@splunk_class_argument_name</span><span class="p">(</span><span class="n">swagger_client</span><span class="p">,</span> <span class="n">SplunkClient</span><span class="p">,</span> <span class="s2">&quot;splunk_client_v10&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ConfigurationSplunk10</span><span class="p">(</span><span class="n">SplunkConfigurationBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">customize_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define configuration to access Splunk v10 instance</span>
</code></pre></div>
In the example above <code>ConfigurationSplunk9</code> is registered without <code>splunk_class_argument_name</code> value specified, which means that framework will attach it and the client class to default <code>splunk_client</code> variable. For configuration class <code>ConfigurationSplunk10</code> <code>splunk_class_argument_name</code> is defined as <em>&ldquo;splunk_client_v10&rdquo;</em> which adds to framework new builtin variable <em>splunk_client_v10</em> and through it framework will make available a Splunk client class object created using <code>ConfigurationSplunk10</code> configuration. This way forges, probes and tests will be able to use both builtin variables if needed:
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">my_forge1</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">:</span> <span class="n">SplunkClient</span><span class="p">,</span> <span class="n">splunk_client_v10</span><span class="p">:</span> <span class="n">SplunkClient</span><span class="p">):</span>
    <span class="n">splunk_client</span><span class="o">.</span><span class="n">some_splunk_client_method</span><span class="p">()</span> <span class="c1"># action at Splunk v9 instance</span>
    <span class="n">splunk_client_v10</span><span class="o">.</span><span class="n">some_splunk_client_method</span><span class="p">()</span> <span class="c1"># same action at Splunk v10 instance</span>

<span class="k">def</span> <span class="nf">my_forge2</span><span class="p">(</span><span class="n">splunk_client_v10</span><span class="p">:</span> <span class="n">SplunkClient</span><span class="p">):</span>
    <span class="n">splunk_client_v10</span><span class="o">.</span><span class="n">some_other_splunk_client_method</span><span class="p">()</span> <span class="c1"># another action at Splunk v10 instance</span>
</code></pre></div></p>
<p>Note that if all client classes are registered with (bound to) custom internal variable names, internal variable &lsquo;splunk_client&rsquo; will still be available and bound to default client and configuration classes with default methods and configuration properties defined.</p>
<h3 id="vendor-client">Vendor client<a class="headerlink" href="#vendor-client" title="Permanent link">&para;</a></h3>
<p>Vendor client is a combination of two classes - client class, responsible for interactions with vendor environment, and configuration class, responsible for providing necessary settings for client class to act and some test data and settings for forge, probe and test functions. This separation is chosen to make it possible to apply different configuration to the same client class and let it communicate with different vendor hosts or point to different test samples and so on. Using provided client and configuration classes framework creates a separate instance of client class for each test and make it available to forges, probes and tests via internally supported function arguments.</p>
<h4 id="vendor-client-class">Vendor client class<a class="headerlink" href="#vendor-client-class" title="Permanent link">&para;</a></h4>
<p>Vendor client class should be created by developer to access vendor related environments like vendor cloud services, appliances or even user desktop monitored by vendor tools in order to trigger desired events. Similar to Splunk client class, this client class is what developer deals with through framework supported function argument <code>vendor_client</code> when implementing framework entities like forges, probes and tests themselves. Framework creates one instance of this class object per test. Having no knowledge about possible vendor environments framework has very little out of the box support for vendor class: base classes for vendor client and configuration. The approach remains similar to the one used for Splunk classes - both custom vendor client and configuration classes must be implemented from base classes offered by framework and then registered in the framework using <code>register_vendor_class</code> or <code>define_vendor_client_argument</code> decorators.</p>
<h4 id="configuration-class">Configuration class<a class="headerlink" href="#configuration-class" title="Permanent link">&para;</a></h4>
<p>Similar to Splunk client configuration, Vendor client configuration class should be created to provide client class with required configuration. Framework binds client and configuration classes at runtime when creates client instances - one for each tests. Framework implements default vendor configuration class that provides access to the same set of command prompt arguments values specified for pytest execution. The only place to setup configuration properties is  <code>customize_configuration</code> method.  In contrast to Splunk client configuration class, it does not have any default vendor configuration properties, so there are no corresponding collection methods to overwrite. 
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">splunk_add_on_ucc_modinput_test.functional.vendor</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">VendorConfigurationBase</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">class</span> <span class="nc">Configuration</span><span class="p">(</span><span class="n">VendorConfigurationBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">customize_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># to be implemented</span>
        <span class="c1"># self.encoded_prop = utils.get_from_environment_variable(</span>
        <span class="c1">#     &quot;ENV_PROP_NAME1&quot;, string_function=utils.Base64.decode</span>
        <span class="c1"># )</span>
        <span class="c1"># self.not_encoded_prop = utils.get_from_environment_variable(</span>
        <span class="c1">#     &quot;ENV_PROP_NAME2&quot;</span>
        <span class="c1"># )</span>
        <span class="k">pass</span>
</code></pre></div></p>
<h3 id="client-classes-register-decorators">Client classes register decorators<a class="headerlink" href="#client-classes-register-decorators" title="Permanent link">&para;</a></h3>
<p>When custom vendor client and configuration classes are implemented there is one more step to be done to let framework know about these classes and use them. Similar to Splunk classes, this can be done by using one of the decorators: <code>register_vendor_class</code> or <code>define_vendor_client_argument</code>. They act the same way as Splunk client binding decorators except they do not require swagger module to be specified. 
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Configuration</span><span class="p">(</span><span class="n">VendorConfigurationBase</span><span class="p">):</span>
    <span class="c1"># your configuration class implementation</span>

<span class="nd">@register_vendor_class</span><span class="p">(</span><span class="n">Configuration</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">VendorClient</span><span class="p">(</span><span class="n">VendorClientBase</span><span class="p">):</span>
    <span class="c1"># code extending base vendor client class</span>
</code></pre></div>
If tests suppose to communicate with different vendor appliances based on different API, framework supports having several different vendor classes bound to different configurations and assigned to different framework internal variable names. Scenario with same class bound to different configurations is also supported.
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">CiscoMeraki</span><span class="p">(</span><span class="n">VendorClientBase</span><span class="p">):</span>
    <span class="c1"># code extending base vendor client class</span>

<span class="k">class</span> <span class="nc">CiscoWSA</span><span class="p">(</span><span class="n">VendorClientBase</span><span class="p">):</span>
    <span class="c1"># code extending base vendor client class</span>

<span class="nd">@vendor_class_argument_name</span><span class="p">(</span><span class="n">CiscoMeraki</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Meraki132Configuration</span><span class="p">(</span><span class="n">VendorConfigurationBase</span><span class="p">,</span> <span class="s2">&quot;meraki132_client&quot;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">customize_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define configuration to access Cisco Meraki v1.32.0 appliance</span>

<span class="nd">@vendor_class_argument_name</span><span class="p">(</span><span class="n">CiscoMeraki</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Meraki138Configuration</span><span class="p">(</span><span class="n">VendorConfigurationBase</span><span class="p">,</span> <span class="s2">&quot;meraki138_client&quot;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">customize_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define configuration to access Cisco Meraki v1.38.0 appliance</span>

<span class="nd">@vendor_class_argument_name</span><span class="p">(</span><span class="n">CiscoWSA</span><span class="p">,</span> <span class="s2">&quot;wsa_client&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">WSAConfiguration</span><span class="p">(</span><span class="n">VendorConfigurationBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">customize_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># define configuration to access Cisco WSA appliance</span>
</code></pre></div>
In the examples above <code>register_vendor_class</code>binds <code>Configuration</code> class to <code>VendorClient</code> class and makes client instances created by this pair available through <code>vendor_client</code> variable. Another example demonstrates <code>vendor_class_argument_name</code> decorator binding same client class <code>CiscoMeraki</code> to two different configurations classes<code>Meraki132Configuration</code> and <code>Meraki138Configuration</code> that become available via <code>meraki132_client</code> and <code>meraki138_client</code> internal variables. As well as another binding of vendor client class <code>CiscoWSA</code> to it&rsquo;s own configuration class <code>WSAConfiguration</code> thad becomes available via <code>wsa_client</code> internal variable. This way forges, probes and tests will be able to use all four  builtin variables if needed:
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">my_forge1</span><span class="p">(</span><span class="n">meraki132_client</span><span class="p">:</span> <span class="n">CiscoMeraki</span><span class="p">,</span> <span class="n">meraki132_client</span><span class="p">:</span> <span class="n">CiscoMeraki</span><span class="p">):</span>
    <span class="n">meraki132_client</span><span class="o">.</span><span class="n">some_meraki_client_method</span><span class="p">()</span> <span class="c1"># action at Meraki appliance with v1.32.0</span>
    <span class="n">meraki138_client</span><span class="o">.</span><span class="n">some_meraki_client_method</span><span class="p">()</span> <span class="c1"># same action at Meraki appliance with v1.32.0</span>

<span class="k">def</span> <span class="nf">my_forge2</span><span class="p">(</span><span class="n">wsa_client</span><span class="p">:</span> <span class="n">CiscoWSA</span><span class="p">):</span>
    <span class="n">wsa_client</span><span class="o">.</span><span class="n">some_ciscowsa_client_method</span><span class="p">()</span> <span class="c1"># another action at Cisco WSA appliance</span>
</code></pre></div>
Note that iff all client classes registered with (bound to) custom internal variable name, internal variable &lsquo;vendor_client&rsquo; will still be available and bound to default client and configuration classes with nor methods of configuration properties defined.</p>
<h3 id="forges">Forges<a class="headerlink" href="#forges" title="Permanent link">&para;</a></h3>
<p>As said earlier, forges are reusable functions responsible for creation and optionally deletion of resources required by tests. Like pytest fixtures forges can receive and return values and can be implemented as regular or generator function functions. If implemented as a generator function, the first yield will be separating setup and teardown code of the forge. In the following sections these topics explained in more details:</p>
<h4 id="forge-function-arguments">Forge function arguments<a class="headerlink" href="#forge-function-arguments" title="Permanent link">&para;</a></h4>
<p>Forge function can receive any number of arguments. Before forge is executed, framework analyses argument names and tries to collect and provide values for forge execution by mapping its function argument names to different internal dictionaries like test artifactory, built in arguments created by framework and arguments explicitly specified by user at forge assignment stage.</p>
<h5 id="builtin-arguments-reserved-argument-names">Builtin arguments (reserved argument names)<a class="headerlink" href="#builtin-arguments-reserved-argument-names" title="Permanent link">&para;</a></h5>
<p>Framework supports the following out of the box builtin properties that can be mapped by name to forge, probe and test function arguments:</p>
<ul>
<li>
<p><strong>splunk_client</strong> - is an instance of splunk client class created by developer separately and registered in framework using corresponding decorator. Framework creates dedicated Splunk client class instance per test, initializing it using configuration class responsible for collecting necessary setting from different sources like environment variables, hardcoded values. There is a way to tell framework to create additional splunk client instance with different configuration that would be mapped it to desired function argument names, for example <code>splunk_v10_client</code>. This may be useful when running tests at two or more splunk instances at the same time, for example, for Splunk or add-on upgrade tests. </p>
</li>
<li>
<p><strong>vendor_client</strong> - similarly to splunk client class this one is an instance of vendor client class created by developer separately and registered in framework using corresponding decorator. Framework creates dedicated vendor client class instance per test, initializing it using configuration class responsible for collecting necessary setting from different sources like environment variables, hardcoded values. There is a way to tell framework to create additional vendor client instances with different configurations that would be mapped it to a desired function arguments names, for example vendor_client_appliance2.  This may be useful when running tests at two or more vendor instances at the same time, for example, when testing with two different vendor appliances or using instances running different versions of vendor software.</p>
</li>
<li>
<p><strong>session_id</strong> - is a unique identifier generated by framework for each test execution. It may be helpful to name reused resources to make sure that from test execution to execution those resources have unique names</p>
</li>
<li>
<p><strong>test_id</strong> - is a unique identifier generated by framework for each test during tests execution. It may be helpful to name resources dedicated to specific tests to avoid conflicts between different tests that other way may by chance get their resources named identically.</p>
</li>
</ul>
<h4 id="forges-as-regular-functions">Forges as regular functions<a class="headerlink" href="#forges-as-regular-functions" title="Permanent link">&para;</a></h4>
<p>Below is example of a forge implemented as a regular function
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">my_forge</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">:</span> <span class="n">SplunkClient</span><span class="p">,</span> <span class="n">test_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">other_argument</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">input_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;my_input_</span><span class="si">{</span><span class="n">test_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">splunk_client</span><span class="o">.</span><span class="n">create_some_input</span><span class="p">(</span><span class="n">input_name</span><span class="p">,</span> <span class="n">other_argument</span><span class="p">)</span> <span class="c1"># some splunk client class method to create an input (exact name depends on the add-on)</span>
    <span class="k">return</span> <span class="n">input_name</span>
</code></pre></div>
When execution above forge for specific test framework will first collect all necessary forge arguments, i.e. splunk_client and test_id will be taken from builtin arguments, other_argument will be mapped either from test artifactory, explicitly defined arguments or from parametrized arguments. Next framework will execute forge with prepared arguments passing them to forge function as keyword arguments. When forge is executed framework gets its return value. If return value is not None framework will create new new key-value pair (artefact) in test artifacts with the name of forge function as key and returned value as a value. </p>
<p>There is a way to let forge to control the name of created artifact as well as to tell framework to save several artifacts. For this instead of returning a single value forge can return a dictionary object with desired artifact names mapped to desired returning values. For example
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">my_forge</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">:</span> <span class="n">SplunkClient</span><span class="p">,</span> <span class="n">test_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">other_argument</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">input_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;my_input_</span><span class="si">{</span><span class="n">test_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">successful</span> <span class="o">=</span> <span class="n">splunk_client</span><span class="o">.</span><span class="n">create_some_input</span><span class="p">(</span><span class="n">input_name</span><span class="p">,</span> <span class="n">other_argument</span><span class="p">)</span>  <span class="c1"># some splunk client class method to create an input</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>  <span class="c1"># it&#39;s recommended to use dict() constructor to makes sure that artifact name used is a valid python variable.</span>
        <span class="n">input_name</span> <span class="o">=</span> <span class="n">input_name</span><span class="p">,</span>
        <span class="n">successful</span> <span class="o">=</span> <span class="n">successful</span>
    <span class="p">)</span>
</code></pre></div>
Above forge function returns dictionary telling framework to update artifactory with &lsquo;input_name&rsquo; and &lsquo;successful&rsquo; artifacts with corresponding values. Note, that if artifacts with the same names already exist the will be overwritten.</p>
<h4 id="forges-as-generators-functions">Forges as generators functions<a class="headerlink" href="#forges-as-generators-functions" title="Permanent link">&para;</a></h4>
<p>Forges as generators are useful when resources created by forge need to be removed and forge should contain teardown code to fullfil deletion. In that case yield statement of generator function splits setup and teardown code like in the following example:
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">my_forge</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">:</span> <span class="n">SplunkClient</span><span class="p">,</span> <span class="n">test_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">other_argument</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">input_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;my_input_</span><span class="si">{</span><span class="n">test_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">successful</span> <span class="o">=</span> <span class="n">splunk_client</span><span class="o">.</span><span class="n">create_some_input</span><span class="p">(</span><span class="n">input_name</span><span class="p">,</span> <span class="n">other_argument</span><span class="p">)</span> <span class="c1"># some splunk client class method to create an input</span>
    <span class="k">yield</span> <span class="nb">dict</span><span class="p">(</span>  <span class="c1"># it&#39;s recommended to use dict() constructor to makes sure that artifact name used is a valid python variable.</span>
        <span class="n">input_name</span> <span class="o">=</span> <span class="n">input_name</span><span class="p">,</span>
        <span class="n">successful</span> <span class="o">=</span> <span class="n">successful</span>
    <span class="p">)</span>
    <span class="c1"># teardown code starts here</span>
    <span class="k">if</span> <span class="n">successful</span><span class="p">:</span>
        <span class="n">splunk_client</span><span class="o">.</span><span class="n">delete_some_input</span><span class="p">(</span><span class="n">input_name</span><span class="p">)</span>
</code></pre></div>
As seen from the example, now instead of returning values to be stored in artifactory they should be yielded. It is fine to use yield without any value - this will mean that forge does not intend to update or create any artifacts in test artifactory. Note that as soon as forge invokes yield operator function return value will be ignored ignored. However if forge function has yield statement but does not yield, framework will again rely on returned forge value. This allows framework to support scenarios with conditional teardown. In other words, when forge needs teardown code to be executed it yields, and if teardown is not needed it returns.
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">my_forge</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">:</span> <span class="n">SplunkClient</span><span class="p">,</span> <span class="n">test_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">does_not_need_teardown</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="n">input_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;my_input_</span><span class="si">{</span><span class="n">test_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">successful</span> <span class="o">=</span> <span class="n">splunk_client</span><span class="o">.</span><span class="n">create_some_input</span><span class="p">(</span><span class="n">input_name</span><span class="p">,</span> <span class="n">other_argument</span><span class="p">)</span> <span class="c1"># some splunk client class method to create an input</span>
    <span class="n">artifacts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>  <span class="c1"># it&#39;s recommended to use dict() constructor to makes sure that artifact name used is a valid python variable.</span>
        <span class="n">input_name</span> <span class="o">=</span> <span class="n">input_name</span><span class="p">,</span>
        <span class="n">successful</span> <span class="o">=</span> <span class="n">successful</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">does_not_need_teardown</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">artifacts</span>

    <span class="k">yield</span> <span class="n">artifacts</span><span class="p">:</span>

    <span class="c1"># teardown code starts here</span>
    <span class="k">if</span> <span class="n">successful</span><span class="p">:</span>
        <span class="n">splunk_client</span><span class="o">.</span><span class="n">delete_some_input</span><span class="p">(</span><span class="n">input_name</span><span class="p">)</span>
</code></pre></div>
In above example forge skips (turns off) teardown block by using <code>return</code> statement when function argument <code>does_not_need_teardown</code> value is True.</p>
<h3 id="artifactory">Artifactory<a class="headerlink" href="#artifactory" title="Permanent link">&para;</a></h3>
<p>Artifactory is an internal storage of key-value pairs maintained for each test function separately. It stores variables added by framework based on analysis of values provided by forges and probes. Test artifactories maintained by the framework automatically based on results collected from forges and probes. As well framework handles mapping of artifacts to forge, probe and test function arguments. This means that as soon as a new key value pair is added to test artifactory it can be used by forge, probe and test functions just by declaring function arguments using names of stored artifacts. For example, let&rsquo;s have a forge that creates an S3 bucket at AWS environment and returns <code>bucket_name</code> artefact
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create_s3_bucket</span><span class="p">(</span><span class="n">vendor_client</span><span class="p">:</span> <span class="n">VendorClient</span><span class="p">,</span> <span class="n">test_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bucket_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]):</span>
    <span class="n">bucket_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;my_s3_bucket_</span><span class="si">{</span><span class="n">test_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">vendor_client</span><span class="o">.</span><span class="n">create_s3_bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">bucket_config</span><span class="p">)</span> <span class="c1"># some vendor client class method to create an s3 bucket</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">)</span>
</code></pre></div>
Now we can create another forge that would upload files with required data samples to created s3 bucket and returns another artifact - <code>successfully_uploaded</code>:
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">upload_s3_bucket_files</span><span class="p">(</span><span class="n">vendor_client</span><span class="p">:</span> <span class="n">VendorClient</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">bucket_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;my_s3_bucket_</span><span class="si">{</span><span class="n">test_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">vendor_client</span><span class="o">.</span><span class="n">upload_file_to_s3_bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">data_file_path</span><span class="p">)</span> <span class="c1"># some vendor client class method to upload files to s3 bucket</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">successfully_uploaded</span><span class="o">=</span><span class="n">success</span><span class="p">)</span>
</code></pre></div>
And finally we implement a test function that depends on the above two forges:
<div class="highlight"><pre><span></span><code><span class="nd">@bootstrap</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">create_s3_bucket</span><span class="p">,</span> <span class="n">bucket_config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;some&quot;</span><span class="p">:</span> <span class="s2">&quot;config&quot;</span><span class="p">}),</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">upload_s3_bucket_files</span><span class="p">,</span> <span class="n">data_file_path</span><span class="o">=</span><span class="s2">&quot;some/file/path&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">test_s3_bucket</span><span class="p">(</span><span class="n">vendor_client</span><span class="p">:</span> <span class="n">VendorClient</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">successfully_uploaded</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">list_of_bucket_resources</span> <span class="ow">is</span> <span class="kc">True</span>
    <span class="n">list_of_bucket_resources</span> <span class="o">=</span> <span class="n">vendor_client</span><span class="o">.</span><span class="n">list_bucket_files</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">expected_resource_name</span> <span class="ow">in</span> <span class="n">list_of_bucket_resources</span>
</code></pre></div>
Above demonstrates how <code>bucket_name</code> and <code>successfully_uploaded</code> artifacts returned by forges can be used in arguments of other forges and in test function arguments.
<code>bootstrap</code> decorator and other control elements required to declare test dependencies are explained in next section. Note where values for other forge arguments are taken from:
- <code>vendor_client</code> and <code>test_id</code> are builtin arguments provided by the framework. 
- <code>bucket_config</code> and <code>data_file_path</code> are defined explicitly by developer at test requirements declaration section.</p>
<h2 id="forge-assignment-scope">Forge assignment <code>scope</code><a class="headerlink" href="#forge-assignment-scope" title="Permanent link">&para;</a></h2>
<p>Forge assignment <code>scope</code> is a name of a common name or a marker grouping several forge assignments to tests. There are no special structures behind such group, only the name. Using the same group name with several forge assignments makes the resource belong to the scope of this group of tests. If to think about forge as about a declaration of test requirement to create a resource, the scope will define a group of tests sharing this resource. Forge <code>scope</code> is an important term in framework that allows to leverage forge setup and teardown parts executions by the framework. Scope is a part of the framework internal mechanism that allows multiply tests to have common dependency, i.e. to reuse resources created by same forge function and avoid unnecessary creations and deletions of this resource multiple times for each test. This mechanism is based on the following logic:</p>
<ol>
<li>
<p>When framework plans execution of a forge function attached to a tests, it looks through internal records to check if this forge function has been already executed in context of a different test. </p>
</li>
<li>
<p>Framework assumes that forge functions is not vulnerable to any side effect. In other words, if to execute the same forge function with the same argument values, it will do the same action or it will generate the same resource. So if framework finds previous execution of the forge with the same argument values, it&rsquo;s about to treat it as requirement for the same resource. </p>
</li>
<li>
<p>If forge argument values are the same framework supposes that it&rsquo;s going to create the same resource and almost ready to make a decision to skip forge execution.</p>
</li>
<li>
<p>The last step before making the final decision about skipping the forge execution is to make sure if this is what developer wants to be done. At this point forge scopes are taken into account. Framework checks the forge declarations at both tests - where the forge function was executed and the current tests. If they have the same scope specified then forge execution is skipped. </p>
</li>
</ol>
<p>Knowing the above logic developer can tell framework how to treat the forge by letting forges to stay in the same scope or split them ito different scopes. Developer can use any string as a scope name, however there are three names that have special meaning for the framework:</p>
<ul>
<li>
<p><code>session</code> - This is default scope name, which means that every forge assigned to every test has this scope if nothing different is specified. So by default all forge assignments belong to the same group for all tests, no matter in which module test is implemented. That in it&rsquo;s turn means that for all tests the same forge function with the same argument values will be treated by framework as creating the same resource and and will be executed only once. </p>
</li>
<li>
<p><code>module</code> - This scope name says that forge assignment scope should be limited to all tests of the same test module (python source file). When framework registers forge assignment to a tests it does not store scope name as is, instead it replaces <code>module</code> with the path of the test module where this assignment takes place. Note that forge assignments with <code>session</code> scope and <code>module</code> scope remain in different scopes even if they are located in the same test module, i.e. <code>module</code> scope is made only of forge assignments with scope <code>module</code> and located in the same test module. In some sense value <code>module</code> is a shortcut to tests module file path, so using it in several test modules in reality creates a separate scope for each of those test modules.</p>
</li>
<li>
<p><code>function</code> - This scope name says framework to consider forge (or resource created by it) only in context of one single tests that this forge is assigned to. This means that framework will never treat this forge as creating common reusable resource. Similar to <code>module</code> scope, <code>function</code> scope name is not saved as is, instead framework replaces <code>function</code> string with full path to the test function that includes the path to test function module source file, test function class if exists and test function name.</p>
</li>
</ul>
<p>Knowing the forge scope (single test or a group of tests), framework can estimate the lifetime of the resource created by forge function. It monitors the moment when the last test using this resource completes and immediately invokes forge teardown part to remove the resource. </p>
<p>To early catch typos in predefined scope names framework defines enum object with corresponding enum values in <code>splunk_add_on_ucc_modinput_test.functional.constants</code> module:
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ForgeScope</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="s2">&quot;function&quot;</span>
    <span class="n">MODULE</span> <span class="o">=</span> <span class="s2">&quot;module&quot;</span>
    <span class="n">SESSION</span> <span class="o">=</span> <span class="s2">&quot;session&quot;</span>
</code></pre></div>
To summarize:</p>
<ul>
<li>
<p>Forge assignment scope is about altering default framework behavior when a forge function assigned to multiply test functions.</p>
</li>
<li>
<p>In most cases there is no need to alter default behavior, as framework can clearly understand when a forge assigned to several tests is going to create the same resource or different one judging only by forge argument values. </p>
</li>
<li>
<p>Explicit scope assignment makes sense only when developer has something specific in mind that does not much default framework behavior and wants to tell framework to create resource for specific test or group of tests where otherwise it would reuse existing resource. </p>
</li>
<li>
<p>Same results can be achieved by manipulation of forge argument values, however some scenarios are more difficult to implement. Easiest scenario is to tell framework that specific forge creates separate resource for each test. It can be done by using builtin forge argument <code>test_id</code> - it will make forge argument values different from test to tests and at the same time provides unique identifier to form a unique name for created resource.</p>
</li>
<li>
<p>When adjusting framework logic by explicitly defining forge assignment scope it is recommended to review names and lifetimes of the resources created by the forge to avoid failures caused by attempting to create resources with the same name as existing ones.</p>
</li>
</ul>
<h2 id="forge-assignment">Forge assignment<a class="headerlink" href="#forge-assignment" title="Permanent link">&para;</a></h2>
<p>For forge assignment to tests framework implements two test function decorators that create binding between forges and a test and at the same time define when forge should be invoked - before all tests execution starts or before exact test execution starts. There are also two data collection helper classes tat allow to arrange forge dependencies and apply additional builtin and custom settings like scope and probe assignment, as well as explicit/in-place forge arguments values definition. Note that the same forge function can be assigned to different test functions, however framework does not support assigning same forge function to the same test function multiply times. Order of forges in which they are listed within used decorator defines forges dependencies, which means that each preceding forge (i.e. resource it creates) becomes a requirement for the forge following it. Note that each test should declare all forges (resources) it depends on, so if too tests depend on same resources they both should have the same list of forges declared in the same order.</p>
<h3 id="helper-data-collection-classes">Helper data collection classes<a class="headerlink" href="#helper-data-collection-classes" title="Permanent link">&para;</a></h3>
<p>These helper classes together allow developer to specify all forge data necessary to create internal forge object, as well as to define which forges can be executed in parallel and which sequentially.</p>
<h4 id="forge-helper-data-collection-class"><code>forge</code> helper data collection class<a class="headerlink" href="#forge-helper-data-collection-class" title="Permanent link">&para;</a></h4>
<p>Let&rsquo;s start with this helper data class <code>forge</code> as it allows to specify all forge data necessary to create internal forge object. It was already used in some example of previous sections. It has only one mandatory positional argument that receives forge function itself. There are two other arguments that have special meaning for the framework - <code>probe</code> and <code>scope</code>. They are optional and if used must be specified as named arguments. The first named argument, <code>probe</code>, allows to link a probe function to the forge function assignment and by default takes value <code>None</code>, which means no probe function is assigned.  The second named argument, <code>scope</code>, defines forge assignment scope. By default scope value for all forge assignments is &ldquo;session&rdquo; if not redefined by <code>forges</code> helper data class. <code>forge</code> class constructor also allows to define argument values for assigned forge. Note that explicitly defines=d value for forge argument will have precedence over artifactory value is such exists in test artifactory. Here is an example of a forge function and this forge assignment using <code>forge</code> helper data class.
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">splunk_add_on_ucc_modinput_test.functional.constants</span> <span class="kn">import</span> <span class="n">ForgeScope</span>
<span class="k">def</span> <span class="nf">create_splunk_index</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">,</span> <span class="n">index_name</span><span class="p">):</span>
    <span class="n">splunk_client</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="n">index_name</span><span class="p">)</span>

<span class="nd">@bootstrap</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">create_splunk_index</span><span class="p">,</span> <span class="n">index_name</span><span class="o">=</span><span class="s2">&quot;some_index&quot;</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">ForgeScope</span><span class="o">.</span><span class="n">FUNCTION</span><span class="p">,</span> <span class="n">probe</span><span class="o">=</span><span class="n">wait_for_index_creation</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">test_something</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">)</span>
    <span class="c1"># test implementation</span>
</code></pre></div>
In above example forge <code>create_splunk_index</code> is assigned to test function <code>test_something</code>. Beside forge function, <code>forge</code> helper data class constructor defines forge assignment (resource) scope as <code>function</code> and assigns <code>wait_for_index_creation</code> function as probe. Additionally it defines <code>index_name</code> argument value for the forge function, so when <code>create_splunk_index</code> function will be invoked it will receive <code>splunk_client</code> object from framework builtin argument and <code>index_name</code> value from this explicit value assignment.  </p>
<p>Within <code>bootstrap</code> or <code>attach</code> assignment decorators can declare multiply forge assignments one after another. This ordered list defines the sequence of forge function execution and can be treated as forge dependencies on each other. In other words, forge A preceding forge B in this least can be taken as forge A is a pre-requirement for forge B and must be executed before forge B. For example, Splunk index should be created before add-on modular input using this index, so forge creating index should be listed before the forge creating the modular input:
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create_splunk_index</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">,</span> <span class="n">index_name</span><span class="p">):</span>
    <span class="n">splunk_client</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="n">index_name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_splunk_input</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">,</span> <span class="n">input_name</span><span class="p">):</span>
    <span class="n">splunk_client</span><span class="o">.</span><span class="n">create_input</span><span class="p">(</span><span class="n">input_name</span><span class="p">)</span>

<span class="nd">@bootstrap</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">create_splunk_index</span><span class="p">)</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">create_splunk_input</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">test_something</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">)</span>
    <span class="c1"># test implementation</span>
</code></pre></div></p>
<h4 id="forges-helper-data-collection-class"><code>forges</code> helper data collection class<a class="headerlink" href="#forges-helper-data-collection-class" title="Permanent link">&para;</a></h4>
<p>This is a helper data class that allows to define at certain position of forge assignment list a sub-list of independent forges that can be executed by framework in parallel. In other words, it allows to put a set of forges in place of a single forge assignment. </p>
<p>This data collection class constructor receives unlimited number of <code>forge</code> data collection object and one optional named argument <code>scope</code> that allows to define scope for the whole group of listed forges.</p>
<p>This helper data collection class can be very useful if the resources to be created do not dependent on each other and though there is no reason to create them one after another. Much faster to create them in parallel.  For example, two types of modular inputs can be created independently but both depend on creation of an index they are going to use:
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create_splunk_index</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">,</span> <span class="n">index_name</span><span class="p">):</span>
    <span class="n">splunk_client</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="n">index_name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_input_of_type_A</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">,</span> <span class="n">input_name</span><span class="p">):</span>
    <span class="n">splunk_client</span><span class="o">.</span><span class="n">create_input_a</span><span class="p">(</span><span class="n">input_name</span><span class="p">)</span>

 <span class="k">def</span> <span class="nf">create_input_of_type_B</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">,</span> <span class="n">input_name</span><span class="p">):</span>
    <span class="n">splunk_client</span><span class="o">.</span><span class="n">create_input_b</span><span class="p">(</span><span class="n">input_name</span><span class="p">)</span>

<span class="nd">@bootstrap</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">create_splunk_index</span><span class="p">)</span>
    <span class="n">forges</span><span class="p">(</span>
        <span class="n">forge</span><span class="p">(</span><span class="n">create_input_of_type_A</span><span class="p">),</span>
        <span class="n">forge</span><span class="p">(</span><span class="n">create_input_of_type_B</span><span class="p">),</span>
        <span class="n">scope</span><span class="o">=</span><span class="n">ForgeScope</span><span class="o">.</span><span class="n">MODULE</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">test_something</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">)</span>
    <span class="c1"># test implementation</span>
</code></pre></div>
Note that in the example <code>scope</code> value is defined in <code>forges</code> and it changes default scope for every forge in its internal list. </p>
<h3 id="forge-assignment-decorators">Forge assignment decorators<a class="headerlink" href="#forge-assignment-decorators" title="Permanent link">&para;</a></h3>
<p><code>bootstrap</code> and <code>attach</code> decorators take a mixed list of <code>forge</code> and <code>forges</code> instancies and do the actual assignment of each forge function to specific test function taking into account dependency information and the settings collected by the data classes. Depending on which decorator was used, assigned forges will have different execution algorithm and schedule.</p>
<h4 id="bootstrap-decorator"><code>bootstrap</code> decorator<a class="headerlink" href="#bootstrap-decorator" title="Permanent link">&para;</a></h4>
<p>In accordance to decorator name it allows to assign forges that should be executed before tests started. There are several rules that framework follows:</p>
<ul>
<li>
<p>Framework executes sequences of bootstrap forges for all tests at the same time. It means that framework will pick first bootstrap forge from each test and execute them all in parallel, then it will go to the next bootstrap forge of each test and again executes them in parallel until there is no bootstrap forges to execute</p>
</li>
<li>
<p>Tests themselves executed sequentially by pytest. Before letting test go framework makes sure that bootstrap forges for this tests are successfully executed.</p>
</li>
<li>
<p>To minimize test waiting for bootstrap forges, framework reorders test functions depending on how many bootstrap forges it has assigned - tests with less bootstrap forges go to the beginning of the test execution list. This way tests with less dependencies will be executed before not waiting for all bootstrap forges to be executed. <em>Note that this internal optimization will not work for tests that besides bootstrap also have forges assigned with <code>attach</code> decorator</em>.</p>
</li>
</ul>
<p>Let&rsquo;s take a look at the example below that has two tests with five different forges assigned - tree forges assigned to one test and two others to the other test:
<div class="highlight"><pre><span></span><code><span class="nd">@bootstrap</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">forge_function1</span><span class="p">)</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">forge_function2</span><span class="p">)</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">forge_function3</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">test_something</span><span class="p">()</span>
    <span class="c1"># test implementation</span>

<span class="nd">@bootstrap</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">forge_function4</span><span class="p">)</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">forge_function5</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">test_something_else</span><span class="p">()</span>
    <span class="c1"># test implementation    </span>
</code></pre></div>
Here are the steps that framework will take to process these tests:</p>
<ol>
<li>
<p>Based on forge assignment information framework will build forge execution matrix like below:
    <div class="highlight"><pre><span></span><code>step 1: forge_function1, forge_function4
step 2: forge_function2, forge_function5
step 3: forge_function3
</code></pre></div></p>
</li>
<li>
<p>Framework will reorder test functions sequence:
    <div class="highlight"><pre><span></span><code>1. test_something_else
2. test_something
</code></pre></div></p>
</li>
<li>
<p>Framework deploys execution of forges. Each step will be executed sequentially, however forge functions in each step will be executed simultaneously using multithreading. By default framework is configured to use 10 threads, which can be adjusted via pytest command option <code>--number-of-threads</code>. </p>
</li>
<li>
<p>Framework finishes setup phase and let pytest to execute tests. According to updated test sequence, test <code>test_something_else</code> will be first for execution.</p>
</li>
<li>
<p>Here framework checks <code>test_something_else</code> test requirements and keep it waiting until forge <code>forge_function5</code> is executed which happens somewhere in the middle of step 2. As soon as forge <code>forge_function5</code> is executed, test  <code>test_something_else</code> is unblocked and pytest executes it as well.</p>
</li>
<li>
<p>After <code>test_something_else</code> test function gets executed, framework will verify if forges assigned to the test will be needed to other tets. In this example forges <code>forge_function4</code> and <code>forge_function5</code> used only with <code>test_something_else</code> tests so framework will try to execute teardown part of each forge if such exist.</p>
</li>
<li>
<p>pytests jumps to test <code>test_something</code> where framework blocks it again until forges deploying it&rsquo;s requirements executed. This time it happens with <code>forge_function3</code> forge execution and actually with completion of the whole bootstrap process. In these forges teardown part is missing.</p>
</li>
<li>
<p>As soon as <code>forge_function3</code> is executed, framework lets pytest to execute <code>test_something</code> test function.</p>
</li>
<li>
<p>After execution of <code>test_something</code> test, framework will verify if forges assigned to the test will be needed to other tets. Again, in this example forges <code>forge_function1</code>,<code>forge_function2</code>  and <code>forge_function3</code> used only with <code>test_something</code> tests so framework will try to execute teardown part of each forge if such exist. In these forges teardown part is also missing.</p>
</li>
</ol>
<p>Let&rsquo;s take a look at another test scenario using bootstrap decorator and reusable forges/resources:
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create_splunk_index</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">):</span>
    <span class="c1"># code to create index</span>

<span class="k">def</span> <span class="nf">create_some_input</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">):</span>
    <span class="c1"># code to create input</span>

<span class="k">def</span> <span class="nf">upload_test_events</span><span class="p">(</span><span class="n">vendor_client</span><span class="p">):</span>
    <span class="c1"># code to upload events</span>

<span class="nd">@bootstrap</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">create_splunk_index</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">test_splunk_index_created</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">,</span> <span class="n">index_name</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">splunk_client</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">index_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="nd">@bootstrap</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">create_splunk_index</span><span class="p">),</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">create_some_input</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">test_some_input_created</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">,</span> <span class="n">input_name</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">splunk_client</span><span class="o">.</span><span class="n">get_some_input</span><span class="p">(</span><span class="n">input_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="nd">@bootstrap</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">create_splunk_index</span><span class="p">),</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">create_some_input</span><span class="p">),</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">upload_test_events</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">test_events_uploaded</span><span class="p">(</span><span class="n">vendor_client</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">vendor_client</span><span class="o">.</span><span class="n">count_uploaded_events</span><span class="p">()</span> <span class="o">==</span> <span class="mi">123</span>
</code></pre></div>
Flowchart for this example test scenario will look as the following:
<img alt="image" src="../images/reusable_forge_resource.jpg" /></p>
<p>As mentioned earlier framework analyzes names, scopes and argument values of assigned forges to decide if same forge used by several tests actually creates the same resource that those tests intend to reuse. In the above tests all reused forges are treated as creating reused resource because they use same default scope, they do not use arguments except splunk and vendor clients (clients are not counted at argument value comparison). Fore reusable resources setup and teardown sections executed once for all tests using this resource - setup part is executed before the first tests using the forge and teardown after the last test using the forge. In this example setup for <code>create_index</code> forge executed before <code>test_splunk_index_created</code> and teardown part of this forge is executed after <code>test_events_uploaded</code>.</p>
<h4 id="attach-decorator"><code>attach</code> decorator<a class="headerlink" href="#attach-decorator" title="Permanent link">&para;</a></h4>
<p>This decorator defines a sequence of forges to be executed right before the tests execution they assigned to. Just like <code>bootstrap</code> decorator, <code>attach</code> decorator accepts a mixed list of <code>forge</code> and <code>forges</code> instances and executes each list item sequentially, while items inside each <code>forges</code> instance are executed all together. Let&rsquo;s take a look at the example below with two test function and five forges assigned to them using <code>attach</code> decorator.
<div class="highlight"><pre><span></span><code><span class="nd">@attach</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">forge_function1</span><span class="p">)</span>
    <span class="n">forges</span><span class="p">(</span>
        <span class="n">forge</span><span class="p">(</span><span class="n">forge_function2</span><span class="p">),</span> 
        <span class="n">forge</span><span class="p">(</span><span class="n">forge_function3</span><span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">test_something</span><span class="p">()</span>
    <span class="c1"># test implementation</span>

<span class="nd">@attach</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">forge_function4</span><span class="p">)</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">forge_function5</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">test_something_else</span><span class="p">()</span>
    <span class="c1"># test implementation    </span>
</code></pre></div>
Here are the steps that framework will take to process these tests:</p>
<ol>
<li>
<p>As there are not bootstrap forges used framework will skip bootstrap planning and execution steps. Execution order will not be changed because of the same reason. So framework will pass control over to pytest to start execution of tests functions. </p>
</li>
<li>
<p>As the test execution order is not changed, pytest starts from <code>test_something</code> test function. First framework will verify that there are not bootstrap dependencies for this tests, so there is nothing to wait from this part. </p>
</li>
<li>
<p>Next framework will check if there are forges assigned using <code>attach</code> decorator (in-place forges). For <code>test_something</code> test function there are three in-place forges assigned - <code>forge_function1</code> forge that is a dependency for other to forges <code>forge_function2</code> and <code>forge_function3</code>. For them framework will build forge execution matrix like below:
    <div class="highlight"><pre><span></span><code>step 1: forge_function1
step 2: forge_function2, forge_function3
</code></pre></div></p>
</li>
<li>
<p>Before framework deploys the forge execution matrix it will wait for bootstrap process to finish, no matter whether there are bootstrap dependencies for this tests or not. In the example there are no bootstrap process and there is nothing to wait for.</p>
</li>
<li>
<p>Framework will deploy the matrix. Like with bootstrap forge execution matrix, each step will be executed sequentially, while forge functions in each step will be executed simultaneously using multithreading. Until the last forge function of execution matrix gets executed, <code>test_something</code> test function remains blocked by framework.</p>
</li>
<li>
<p>Framework unblocks test and let it be executed by pytest engine.</p>
</li>
<li>
<p>After execution of <code>test_something</code> test, framework will verify if forges assigned to the test will be needed to other tets. Again, in this example forges <code>forge_function1</code>,<code>forge_function2</code>  and <code>forge_function3</code> used only with <code>test_something</code> tests so framework will try to execute teardown part of each forge if such exist. In these forges teardown part is also missing.</p>
</li>
<li>
<p>Now framework lets pytest to switch to the next test which in our example is <code>test_something_else</code>.</p>
</li>
<li>
<p>Again framework prepares forge execution matrix for the test
    <div class="highlight"><pre><span></span><code>step 1: forge_function4
step 2: forge_function5
</code></pre></div></p>
</li>
<li>
<p>&hellip; verifies if the test should wait for its bootstrap dependencies and bootstrap precess as a whole, runs forges execution matrix.</p>
</li>
<li>
<p>When all forges are executed framework let&rsquo;s pytest to run the test.</p>
</li>
<li>
<p>After test execution, framework invokes teardown sections of the forges no longer required by other tests. In above example <code>test_something_else</code> is the last tests so no resources a needed anymore so framework will try to invoke teardown for remaining forges - <code>forge_function4</code> and <code>forge_function5</code>. However those forges do not have teardown sections so at the end no cleanup code will be invoked.</p>
</li>
</ol>
<h4 id="when-using-bootstrap-and-attach-decorators-together-with-the-same-test">When using <code>bootstrap</code> and <code>attach</code> decorators together with the same test<a class="headerlink" href="#when-using-bootstrap-and-attach-decorators-together-with-the-same-test" title="Permanent link">&para;</a></h4>
<p>Tests can have forges assigned using both decorators at the same time. In general execution flow for tests having both types of forges will look a combination of the two previous tests:</p>
<ol>
<li>
<p>Framework executes test bootstrap forges in together with other tests bootstrap forges</p>
</li>
<li>
<p>Test waits for it&rsquo;s turn according to pytest item list</p>
</li>
<li>
<p>Framework executes test attached forges</p>
</li>
<li>
<p>pytest executes the test itself</p>
</li>
<li>
<p>Framework executes teardown sections of no longer needed resources</p>
</li>
</ol>
<p>As seen from previous sections, attached forges always executed after bootstrap process is fully complete. In practice it means that test sorting done by framework for optimization purposed will not move tests with attached forges to the beginning of the list even if such tests does not have bootstrap forges at all, - in contrast such tests will be places after the last test without attached forges and with maximum number of bootstrap forges.</p>
<p>Lets take a look at one more example:
<div class="highlight"><pre><span></span><code><span class="nd">@attach</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">forge_function1</span><span class="p">)</span>
    <span class="n">forges</span><span class="p">(</span>
        <span class="n">forge</span><span class="p">(</span><span class="n">forge_function2</span><span class="p">),</span> 
        <span class="n">forge</span><span class="p">(</span><span class="n">forge_function3</span><span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">test_something</span><span class="p">()</span>
    <span class="c1"># test implementation</span>

<span class="nd">@bootstrap</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">forge_function4</span><span class="p">)</span>
<span class="p">)</span>
<span class="nd">@attach</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">forge_function5</span><span class="p">)</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">forge_function6</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">test_something_else</span><span class="p">()</span>
    <span class="c1"># test implementation    </span>

<span class="nd">@bootstrap</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">forge_function7</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">test_something_more</span><span class="p">()</span>
    <span class="c1"># test implementation    </span>
</code></pre></div>
In the above example framework will reorder tests the following way:
<div class="highlight"><pre><span></span><code>step1: test_something_more
step2: test_something
step3: test_something_else
</code></pre></div>
Test <code>test_something_more</code> goes to the beginning of the list because it does not have attached forges and has minimum number of bootstrap forges. Tests <code>test_something</code> and test_something_else have attached forges so they go to the end of the list. However <code>test_something</code> has less bootstrap forges then <code>test_something_else</code>, so it lends in the list before <code>test_something_else</code> test. Framework logs forge execution matrices and test execution order in log file splunk-add-on-ucc-modinput-test-functional.log so developer can review it when have doubts.</p>
<p>Note that it&rsquo;s not allowed to have the same forge assigned to the same test more than once, no matter if only one or both decorators are used. In other words, if forge is listed in one of the decorators, it cannot be listed neither in the same decorator second time or appear in the list of the other decorator.</p>
<h4 id="support-for-parametrized-test-arguments">Support for parametrized test arguments<a class="headerlink" href="#support-for-parametrized-test-arguments" title="Permanent link">&para;</a></h4>
<p>Framework supports test parametrized arguments by making them available for forges and probes via function arguments. Below is an example showing how to access parametrized arguments in forges and tests. Test declares <code>input_type</code> parametrize argument that takes tree possible values. Just like test function, to use this parametrized argument example forge and probe functions should declare argument with the same name in their function arguments. Note that parametrized argument is not mandatory for forges and probes, in contrast to test function they need to declare this argument only if they are going to use it.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># forge to create an input of specific type and with specific name</span>
<span class="k">def</span> <span class="nf">create_some_input</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">test_id</span><span class="p">):</span>
    <span class="n">input_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">input_type</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">test_id</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">splunk_client</span><span class="o">.</span><span class="n">create_input_of_type</span><span class="p">(</span><span class="n">input_type</span><span class="p">,</span> <span class="n">input_name</span><span class="p">)</span>  <span class="c1"># forge code implemented by developer to create inputs</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">input_name</span> <span class="o">=</span> <span class="n">input_name</span><span class="p">,</span>
        <span class="n">input_type</span> <span class="o">=</span> <span class="n">input_type</span>
    <span class="p">)</span>

<span class="c1"># probe to wait for input to be created</span>
<span class="k">def</span> <span class="nf">is_input_created</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">input_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">splunk_client</span><span class="o">.</span><span class="n">get_input</span><span class="p">(</span><span class="n">input_type</span><span class="p">,</span> <span class="n">input_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># probe code to verify that input exists</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;input_type&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;input_type_name1&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;input_type_name4&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;input_type_name3&quot;</span><span class="p">]</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="nd">@bootstrap</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">create_some_input</span><span class="p">,</span> <span class="n">probe</span><span class="o">=</span><span class="n">is_input_created</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_input_started_successfully</span><span class="p">(</span><span class="n">input_type</span><span class="p">):</span>    
    <span class="c1"># some verification code</span>
</code></pre></div>
<h3 id="probes">Probes<a class="headerlink" href="#probes" title="Permanent link">&para;</a></h3>
<p>The single purpose of a probe is to do a check that certain resource is created or required conditions met. Probes are used by the framework together with forges and let it verify that an action taken by a forge achieved the expected result and if it&rsquo;s not to wait for expected result if necessary. This means that if for some reason result of the probe is negative, framework will keep calling the probe in certain intervals until it gets successful or the time configured for waiting the expected result expires. Though framework does not jump to the next following forge execution until probe succeeds or expires. Probes can use any parameters saved in test artifactory by declaring them in probe function arguments. There are two ways do implement a probe supported by the unified functional test framework - using function or using generator function. Depending on the approach chosen, developer will have different control on the verification process and requirements to probe return values.</p>
<h4 id="probe-as-function">Probe as function<a class="headerlink" href="#probe-as-function" title="Permanent link">&para;</a></h4>
<p>As follows from the name, this kind of probe is a regular function returning True or False, depending on if it was successful or failed accordingly. So it&rsquo;s pretty simple to implement and developer is required just to create straightforward code checking some desired condition. Framework in its turn is responsible for calling this probe with default frequency until it gets successful or default timeout is reached. The probe call interval and expiration period for all such probes are defined globally and can be controlled vial pytest command prompt arguments <code>--probe-invoke-interval=\&lt;value in seconds\&gt;</code> and <code>--probe-wait-timeout=\&lt;value in seconds\&gt;</code> correspondingly. In case of any exception raised inside probe ite will be taken as permanently failed without any following attempts to call it again and the whole corresponding test will be marked as failed as well. The same way probe timeout rises internal framework SplTaFwkWaitForProbeTimeout exception that fails the probe together with corresponding forge and the test.  Note that this kind of probe does not know about how many time it was called, if the current call is the first for the forge or consequent, what is the elapse time of waiting for a check to succeed. </p>
<p>Here how this type of probe may look:
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">some_input_is_created</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">:</span> <span class="n">SplunkClient</span><span class="p">,</span> <span class="n">input_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">splunk_client</span><span class="o">.</span><span class="n">get_some_input</span><span class="p">(</span><span class="n">input_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div></p>
<h4 id="probe-as-generator-function">Probe as generator function<a class="headerlink" href="#probe-as-generator-function" title="Permanent link">&para;</a></h4>
<p>This approach is more complicated and requires developer to create a generator which fulfils required protocol to interact with the framework: 
- in case of unsuccessful check this generator should yield integer positive value in seconds that framework should use as interval before calling probe once again. Framework verifies yielded interval value and makes sure it&rsquo;s within 1-60. Framework will update interval with minimum or maximum value of the expected range in case yielded interval value is less than the range minimum or bigger than the range maximum correspondingly.
- if the check was successful, generator should exit optionally returning True. 
- if probe has internally defined timeout which is less than global probe timeout, the probe can gracefully exit returning False or through an exception.
- if probe does not have internal timeout or internal timeout is greater then global probe timeout the framework will raise internal probe timeout exception when probing process time exceeded global probe timeout.</p>
<p>Here how this type of probe may look:
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">some_input_is_created</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">:</span> <span class="n">SplunkClient</span><span class="p">,</span> <span class="n">input_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="p">:</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="c1"># can have here some preliminary preparations or checks</span>
    <span class="k">while</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
        <span class="n">success</span> <span class="o">=</span> <span class="n">splunk_client</span><span class="o">.</span><span class="n">get_some_input</span><span class="p">(</span><span class="n">input_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">yield</span> <span class="mi">10</span>

    <span class="k">return</span> <span class="kc">False</span> <span class="c1"># or raise and exception</span>
</code></pre></div>
As seen from the example this type of probe is aware about probing progress and has more control over it:</p>
<ul>
<li>
<p>it defines check interval and can vary it depending on progress conditions</p>
</li>
<li>
<p>it can decide if with probe failing also to fail the test or exit gracefully giving a chance to a test to decide how to treat probe failing</p>
</li>
<li>
<p>it can have some kind of init code for preliminary preparations and checks.</p>
</li>
</ul>
<h4 id="helper-search-probe-as-generator-function">Helper search probe as generator function<a class="headerlink" href="#helper-search-probe-as-generator-function" title="Permanent link">&para;</a></h4>
<p>To make creation of generator function probes easier framework provides a default probe as a methods of splunk_client built in argument. The probe is based on search operation in Splunk index which is most popular way of probing when it&rsquo;s needed to make sure that expected events have been ingested or logs have been generated by an add-on code. A probe using this helper probe will look like the following:
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">wait_for_some_input_to_start</span><span class="p">(</span>
    <span class="n">splunk_client</span><span class="p">:</span> <span class="n">SplunkClient</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">]:</span>
    <span class="n">probe_spl</span> <span class="o">=</span> <span class="s2">&quot;some SPL looking into Splunk _internal index for a log generated by input process at start&quot;</span>
    <span class="n">successful</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">splunk_client</span><span class="o">.</span><span class="n">search_probe</span><span class="p">(</span>
        <span class="n">probe_spl</span><span class="p">,</span>      <span class="c1"># the SPL to search</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>     <span class="c1"># maximum time in seconds given to get successful result. It&#39;s an optional argument with default value 300</span>
        <span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>    <span class="c1"># interval of prove invocation. It&#39;s an optional argument with default value 5</span>
        <span class="n">verify_fn</span> <span class="o">=</span> <span class="n">my_verify_function</span><span class="p">,</span>  <span class="c1"># optional function to search result analysis return ing True/False. </span>
                                        <span class="c1"># by default the probe is successful search returns at least one record</span>
        <span class="n">probe_name</span><span class="o">=</span><span class="s2">&quot;wait_for_some_input_to_start&quot;</span> <span class="c1"># optional name of your probe used only for test logging</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">successful</span>
</code></pre></div>
As seen from the example comments, only probe_spl argument is mandatory to call this helper probe.</p>
<p>By defining your own verification function (verify_fn argument) it&rsquo;s possible to alter expected condition for positive result. By default it expects from SPL any non empty result. Custom verify function like below will make it expect some specific number of events , let it be 10:
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">my_verify_function</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">SearchState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">result_count</span> <span class="o">==</span> <span class="mi">10</span>
</code></pre></div></p>
<h4 id="probe-arguments-and-return-value">Probe arguments and return value<a class="headerlink" href="#probe-arguments-and-return-value" title="Permanent link">&para;</a></h4>
<p>To summarize, a probe can rely on any built in framework argument or any artefact (a property stored in test artifactory) just by declaring probe function arguments with the same names as expected artifacts. It&rsquo;s not possible to pass to a probe any argument value explicitly, but it&rsquo;s possible to do it via argument of the the forge this probe is assigned to and this forge should saves the argument in test artifactory. Probe can return a boolean value. If it does, framework will handle it and add to test artifactory with the name of probe function as the key and the returned boolean value as the value. This artefact can then be used by the test and by other probes and forges executed at later processing stages.</p>
<h2 id="test">Test<a class="headerlink" href="#test" title="Permanent link">&para;</a></h2>
<p>Test is an any function recognized by pytest as test function. Test can be a regular function or test class method. To become a part of unified functional test framework workflow a test must have at least one the forge assignment decorators applied.</p>
<h3 id="test-execution-order">Test execution order<a class="headerlink" href="#test-execution-order" title="Permanent link">&para;</a></h3>
<p>As explained in previous sections framework reorders tests based on assigned forges to improve overall test execution time. During this process framework reorders all the tests no matter if it&rsquo;s a part of the framework or not. . All tests that are not part of the framework (i.e. do not have forges assigned) will go to the beginning of the execution list and will be invoked right after framework bootstrap forge execution stats and not waiting for it completion.</p>
<h3 id="test-arguments">Test arguments<a class="headerlink" href="#test-arguments" title="Permanent link">&para;</a></h3>
<p>Being a part of framework tests gets access to test artifactory and framework builtin arguments like splunk_client, vendor_client, test_is, session_id and so on. Below is an example demonstration how those arguments can be used in test:
<div class="highlight"><pre><span></span><code><span class="c1"># forge to create an input of specific type and with specific name</span>
<span class="k">def</span> <span class="nf">create_some_input</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">test_id</span><span class="p">):</span>
    <span class="n">input_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">input_type</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">test_id</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">splunk_client</span><span class="o">.</span><span class="n">create_input_of_type</span><span class="p">(</span><span class="n">input_type</span><span class="p">,</span> <span class="n">input_name</span><span class="p">)</span>  <span class="c1"># forge code impemented by developer to create inputs</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">input_type</span><span class="o">=</span><span class="n">input_type</span><span class="p">,</span>
        <span class="n">input_name</span><span class="o">=</span><span class="n">input_name</span>
    <span class="p">)</span>

<span class="c1"># probe to wait for input to be created</span>
<span class="k">def</span> <span class="nf">is_input_created</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">input_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">splunk_client</span><span class="o">.</span><span class="n">get_input</span><span class="p">(</span><span class="n">input_type</span><span class="p">,</span> <span class="n">input_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># probe code to verify that input exists</span>

<span class="nd">@bootstrap</span><span class="p">(</span>
    <span class="n">forge</span><span class="p">(</span><span class="n">create_some_input</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="s2">&quot;some_type&quot;</span><span class="p">,</span> <span class="n">probe</span><span class="o">=</span><span class="n">is_input_created</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_input_started_successfully</span><span class="p">(</span><span class="n">splunk_client</span><span class="p">,</span> <span class="n">test_id</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">is_input_created</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_input_created</span> <span class="ow">is</span> <span class="kc">True</span> <span class="c1"># make sure probe did not timeout</span>
    <span class="k">assert</span> <span class="n">test_id</span> <span class="ow">in</span> <span class="n">input_name</span> <span class="ow">and</span> <span class="n">input_type</span> <span class="ow">in</span> <span class="n">input_name</span> <span class="c1"># make sure input name generated correctly</span>
    <span class="k">assert</span> <span class="n">splunk_client</span><span class="o">.</span><span class="n">look_for_input_initialization_logs</span><span class="p">(</span><span class="n">input_name</span><span class="p">)</span> <span class="c1"># some method implemented by developer </span>
                                                                        <span class="c1"># to search for input initialization logs </span>
                                                                        <span class="c1"># to make sure it&#39;s started successfully</span>
</code></pre></div>
As seen from above <code>test_input_started_successfully</code> declares five arguments provided by the framework:</p>
<ul>
<li>
<p><code>splunk_client</code> and <code>test_id</code> are built in framework arguments providing for tests an instance of Splunk client class and internal framework test id.</p>
</li>
<li>
<p><code>input_type</code> and  <code>input_name</code> are two variables from test artifactory saved there by <code>create_some_input</code> forge.</p>
</li>
<li>
<p><code>is_input_created</code> is a variable created by framework to store last result of probe function which contains result of the last probe execution. Checking it allows to verify whether probe was executed with positive result or it was not successful and framework stopped executing it because of the timeout.</p>
</li>
</ul>
<h3 id="tasks">Tasks<a class="headerlink" href="#tasks" title="Permanent link">&para;</a></h3>
<p>Task is not what developer is going to deal with directly. Task is an internal framework entity that is a combination of a forge function with specific argument values and optionally attached probe that should be executed for a specific test.</p>
<h2 id="forge-execution-flow-and-resource-lifetime-diagram">Forge execution flow and resource lifetime diagram<a class="headerlink" href="#forge-execution-flow-and-resource-lifetime-diagram" title="Permanent link">&para;</a></h2>
<p>Below is forge execution flow diagram for an example test set. Diagram demonstrates how framework default logic works when it schedules and processes tests having different amounts and types of forges assigned. Example is simplified the way that forges do not take arguments and do not have scopes altered, so framework will treat reuse of a forges as reuse of the resources created by them. In other words, when multiple test have the same forge function assigned it&rsquo;s taken by framework that all these tests are going to reused the same resource. By design, for a reused resource framework executes corresponding forge setup and teardown sections only once, despite the fact that forge is assigned to multiply tests - setup part is executed before the first tests using the forge and teardown after the last test using the forge. In the diagram skipped forge setup executions for reused resources marked with red cross.</p>
<p>I the diagram the very left column contains tests (without bodies) with forge assignment headers showing the binding of the tests and the forges. In the middle of the diagram there is a time arrow splitting bootstrap forges execution flow on the left and other test and forge execution states on the right. On the left side each column shows forge execution flow for each separate test. On the right each column is a test execution state reflecting test and forges in this state at certain moment of time.
<img alt="image" src="../images/forge_execution_flow.jpg" />
<em>Note:</em></p>
<ul>
<li>
<p><em>Assuming that primary forge purpose is creation of resources at vendor and Splunk side, term resource lifetime means time interval between forge setup and teardown invocations</em></p>
</li>
<li>
<p><em>In a real live forges will do have arguments. When comparing forge argument values framework ignores arguments representing Splunk and vendor clients.</em></p>
</li>
</ul>
<h2 id="best-practices">Best practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Make sure that what forge do and what it returns depends only on forge input arguments values. Avoid using random stings or mutating side values when creating names for resources generated by a forge. This is what framework assumes forges do.</p>
</li>
<li>
<p>Try to use bootstrap forges where possible. They executed all together for all tests that makes tests execution faster. Use attached forges only when bootstrap forge unnecessary complicates test logic or when bootstrap forge cannot be used at all (for example, when configuring single instance resources, like add-on proxy)</p>
</li>
<li>
<p>Use test function only for asserts/verifications and if needed for collecting data required for verification. Avoid using it to create resources or apply configurations - those actions should be done in forges. This approach gives more space to parallelize execution process</p>
</li>
<li>
<p>Let forge do one thing while keeping balance between size of forges and size of test assignment header. So it can be one small thing or one big thing.</p>
</li>
<li>
<p>Name forges the way that makes it clear what it does when you see it assigned to a test.</p>
</li>
</ul>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="troubleshooting-resources">Troubleshooting resources<a class="headerlink" href="#troubleshooting-resources" title="Permanent link">&para;</a></h3>
<h4 id="log-file-splunk-add-on-ucc-modinput-test-functionallog">Log file splunk-add-on-ucc-modinput-test-functional.log<a class="headerlink" href="#log-file-splunk-add-on-ucc-modinput-test-functionallog" title="Permanent link">&para;</a></h4>
<p>This is low level framework log. Everything logged goes there from internal framework implementation. This log file collects detail information about tests, probes and forges execution, forge execution schedules, updated test order and so on. Below are several log examples:</p>
<h5 id="informational-log-examples">Informational log examples<a class="headerlink" href="#informational-log-examples" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Example of logged test execution order
    <div class="highlight"><pre><span></span><code>Test execution order:
0. .../tests/ucc_modinput_functional/test_canary.py::test_canary_boostrap
    Level 0
        .../tests/ucc_modinput_functional/splunk/forges/canary.py::splunk_canary_forge
        .../tests/ucc_modinput_functional/vendor/forges/canary.py::vendor_canary_forge
1. .../tests/ucc_modinput_functional/test_canary.py::test_canary_attach
2. .../tests/ucc_modinput_functional/test_settings.py::test_valid_loglevel
3. .../tests/ucc_modinput_functional/test_settings.py::test_proxy_validators__invalid_params[overwrite0-Error in validating proxy configuration]
4. .../tests/ucc_modinput_functional/test_settings.py::test_proxy_validators__invalid_params[overwrite1-All of the following errors need to be fixed: [&quot;Not matching the pattern: ^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])\\\\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9])$&quot;]]
5. .../tests/ucc_modinput_functional/test_settings.py::test_proxy_validators__invalid_params[overwrite2-Invalid format for numeric value]
6. .../tests/ucc_modinput_functional/test_canary.py::test_canary_mixed
    Level 0
        .../tests/ucc_modinput_functional/splunk/forges/canary.py::splunk_canary_forge
</code></pre></div></p>
</li>
<li>
<p>Example of logged bootstrap forges execution matrix
    <div class="highlight"><pre><span></span><code>Bootstrap Dependency execution matrix:
Step 1:
    test 1: .../tests/ucc_modinput_functional/test_canary.py::test_canary_boostrap
        Dependency .../tests/ucc_modinput_functional/splunk/forges/canary.py::splunk_canary_forge, scope session
        Dependency .../tests/ucc_modinput_functional/vendor/forges/canary.py::vendor_canary_forge, scope session
    test 2: .../tests/ucc_modinput_functional/test_canary.py::test_canary_attach
        No dependencies at this step
    test 3: .../tests/ucc_modinput_functional/test_canary.py::test_canary_mixed
        Dependency .../tests/ucc_modinput_functional/splunk/forges/canary.py::splunk_canary_forge, scope session
    test 4: .../tests/ucc_modinput_functional/test_settings.py::test_valid_loglevel
        No dependencies at this step
    test 5: .../tests/ucc_modinput_functional/test_settings.py::test_proxy_validators__invalid_params[overwrite0-Error in validating proxy configuration]
        No dependencies at this step
    test 6: .../tests/ucc_modinput_functional/test_settings.py::test_proxy_validators__invalid_params[overwrite1-All of the following errors need to be fixed: [&quot;Not matching the pattern: ^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])\\\\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9])$&quot;]]
        No dependencies at this step
    test 7: .../tests/ucc_modinput_functional/test_settings.py::test_proxy_validators__invalid_params[overwrite2-Invalid format for numeric value]
        No dependencies at this step
</code></pre></div></p>
</li>
<li>
<p>logs about waiting for something</p>
<ul>
<li>
<p>waiting fro bootstrap
<div class="highlight"><pre><span></span><code>2025-02-25 14:19:06.263 DEBUG splunk-add-on-ucc-modinput-test-functional pid=83518 tid=8601208896 file=manager.py func=wait_for_test_bootstrap line=402 &lt;Test /Users/okashaev/TA/github/splunk-add-on-for-google-cloud-platform/tests/ucc_modinput_functional/test_google_cloud_rh_inputs_monitoring.py::test_valid_monitoring_input&gt; is waiting for bootstrap dependencies
</code></pre></div></p>
</li>
<li>
<p>waiting for attached forges
<div class="highlight"><pre><span></span><code>2025-02-25 14:19:36.294 DEBUG splunk-add-on-ucc-modinput-test-functional pid=83518 tid=8601208896 file=executor.py func=wait line=230 Still waiting for executor to process all attached tasks
</code></pre></div></p>
</li>
<li>
<p>waiting for a probe
<div class="highlight"><pre><span></span><code>2025-03-13 09:50:38.847 DEBUG splunk-add-on-ucc-modinput-test-functional pid=30209 tid=12922871808 file=task.py func=wait_for_probe line=272 WAIT FOR PROBE
    test (&#39;.../tests/ucc_modinput_functional/test_settings.py&#39;, &#39;test_valid_loglevel2&#39;)
    forge (&#39;.../tests/ucc_modinput_functional/splunk/forges/settings.py&#39;, &#39;set_loglevel&#39;, &#39;session&#39;)
    probe &lt;function wait_for_loglevel at 0x7fde3009ee60&gt;
    probe_gen &lt;function wait_for_loglevel at 0x7fde3009ee60&gt;
    probe_args {&#39;splunk_client&#39;: &lt;tests.ucc_modinput_functional.splunk.client.splunk_client.SplunkClient object at 0x7fde70f70790&gt;, &#39;expected_loglevel&#39;: &#39;CRITICAL&#39;}
</code></pre></div></p>
</li>
<li>Logs the moment when forge was marked as executed. If this is the last test dependency/requirement framework triggers execution of the test itself. 
<div class="highlight"><pre><span></span><code>2025-03-13 09:50:39.211 DEBUG splunk-add-on-ucc-modinput-test-functional pid=30209 tid=12922871808 file=task.py func=mark_as_executed line=311 MARK TASK EXECUTED: .../tests/ucc_modinput_functional/splunk/forges/settings.py::set_loglevel,
    self id: 140592265375440,
    scope: session,
    exec_id: 1741855836527287152,
    test: (&#39;.../tests/ucc_modinput_functional/test_settings.py&#39;, &#39;test_valid_loglevel2&#39;),
    is_executed: True,
    is_failed: False,
    errors: []
</code></pre></div></li>
<li>Successful forge execution:
<div class="highlight"><pre><span></span><code>2025-03-26 15:16:49.269 INFO splunk-add-on-ucc-modinput-test-functional pid=5628 tid=12955860992 file=task.py func=execute line=448 Forge has been executed successfully, time taken 0.851635217666626 seconds:
test: test_proxy_validators__invalid_params[overwrite1-Bad Request -- Invalid format for integer value],
    location: .../tests/ucc_modinput_functional/test_settings.py,
    forge: try_to_configure_proxy,
        location: .../tests/ucc_modinput_functional/splunk/forges.py,
        scope: session,
        exec id: 1742998608417570622,
        kwargs: {&#39;overwrite&#39;: {&#39;proxy_port&#39;: &#39;not-a-number&#39;}, &#39;splunk_client&#39;: &lt;tests.ucc_modinput_functional.splunk.client.client.SplunkClient object at 0x7fd2e88c98d0&gt;},
    probe: None,
        location: None,
        kwargs: {},
</code></pre></div></li>
<li>Probe related information</li>
<li>Information about probe waiting started:
    <div class="highlight"><pre><span></span><code>2025-03-26 15:16:49.270 DEBUG splunk-add-on-ucc-modinput-test-functional pid=5628 tid=12955860992 file=task.py func=wait_for_probe line=289 WAIT FOR PROBE started
    test (&#39;.../tests/ucc_modinput_functional/test_settings.py&#39;, &#39;test_proxy_validators__invalid_params[overwrite1-Bad Request -- Invalid format for integer value]&#39;)
    forge (&#39;.../tests/ucc_modinput_functional/splunk/forges.py&#39;, &#39;try_to_configure_proxy&#39;, &#39;session&#39;)
    probe None
</code></pre></div></li>
<li>Information about keeping waiting for a probe
    <div class="highlight"><pre><span></span><code>2025-03-13 09:50:38.847 DEBUG splunk-add-on-ucc-modinput-test-functional pid=30209 tid=12922871808 file=task.py func=wait_for_probe line=272 WAIT FOR PROBE
    test (&#39;.../tests/ucc_modinput_functional/test_settings.py&#39;, &#39;test_valid_loglevel2&#39;)
    forge (&#39;.../tests/ucc_modinput_functional/splunk/forges/settings.py&#39;, &#39;set_loglevel&#39;, &#39;session&#39;)
    probe &lt;function wait_for_loglevel at 0x7fde3009ee60&gt;
    probe_gen &lt;function wait_for_loglevel at 0x7fde3009ee60&gt;
    probe_args {&#39;splunk_client&#39;: &lt;tests.ucc_modinput_functional.splunk.client.splunk_client.SplunkClient object at 0x7fde70f70790&gt;, &#39;expected_loglevel&#39;: &#39;CRITICAL&#39;}
</code></pre></div></li>
</ul>
</li>
<li>
<p>Sequence of logs related to teardown </p>
<ul>
<li>
<p>Teardown is detected and registered
    <div class="highlight"><pre><span></span><code>2025-03-14 13:44:59.917 DEBUG splunk-add-on-ucc-modinput-test-functional pid=56915 tid=13014884352 file=forge.py func=add line=110 REGISTER TEARDOWN 1741956297949821364: 
Teardown summary:
    data.id: 1741956297949821364,
    data.count=1,
    data.is_teardown_executed=False
    data.teardown=&lt;generator object set_loglevel at 0x7fba30567d50&gt;
    data.kwargs={&#39;loglevel&#39;: &#39;CRITICAL&#39;}
    data.result={&#39;expected_loglevel&#39;: &#39;CRITICAL&#39;, &#39;wait_for_loglevel&#39;: True}
    teardown_is_blocked=False
</code></pre></div></p>
</li>
<li>
<p>Teardown information:
    <div class="highlight"><pre><span></span><code>2025-03-26 15:16:49.295 DEBUG splunk-add-on-ucc-modinput-test-functional pid=5628 tid=8606839296 file=task.py func=teardown line=487 Teardown task
    _exec_id: 1742998608417570622
    forge: .../tests/ucc_modinput_functional/splunk/forges.py::try_to_configure_proxy,
    scope: session,
    task: (&#39;.../tests/ucc_modinput_functional/test_settings.py&#39;, &#39;test_proxy_validators__invalid_params[overwrite1-Bad Request -- Invalid format for integer value]&#39;)
    teardown &lt;generator object try_to_configure_proxy at 0x7fd31aeea1d0&gt;
</code></pre></div></p>
</li>
<li>
<p>Teardown state before execution
    <div class="highlight"><pre><span></span><code>2025-03-26 15:16:49.295 DEBUG splunk-add-on-ucc-modinput-test-functional pid=5628 tid=8606839296 file=forge.py func=dereference_teardown line=165 BEFORE EXECUTE TEARDOWN 1742998608417570622:
Teardown summary:
    data.id: 1742998608417570622,
    data.count=1,
    data.is_teardown_executed=False
    data.teardown=&lt;generator object try_to_configure_proxy at 0x7fd31aeea1d0&gt;
    data.kwargs={&#39;overwrite&#39;: {&#39;proxy_port&#39;: &#39;not-a-number&#39;}}
    data.result={&#39;expected_proxy&#39;: {&#39;proxy_enabled&#39;: &#39;0&#39;, &#39;proxy_port&#39;: &#39;not-a-number&#39;, &#39;proxy_rdns&#39;: &#39;1&#39;, &#39;proxy_type&#39;: &#39;http&#39;, &#39;proxy_url&#39;: &#39;localhost&#39;, &#39;proxy_username&#39;: &#39;some_user_name&#39;, &#39;proxy_password&#39;: &#39;some_password&#39;}, &#39;error&#39;: &#39;Unexpected error &quot;&lt;class \&#39;splunktaucclib.rest_handler.error.RestError\&#39;&gt;&quot; from python handler: &quot;REST Error [400]: Bad Request -- Invalid format for numeric value&quot;. See splunkd.log/python.log for more details.&#39;, &#39;status_code&#39;: 500}
    teardown_is_blocked=False
</code></pre></div></p>
</li>
<li>
<p>Teardown check to execute or postpone teardown execution
    <div class="highlight"><pre><span></span><code>2025-03-26 15:16:49.295 DEBUG splunk-add-on-ucc-modinput-test-functional pid=5628 tid=8606839296 file=forge.py func=exec_teardown_if_ready line=92 CAN EXECUTE TEARDOWN True:
Teardown summary:
    data.id: 1742998608417570622,
    data.count=0,
    data.is_teardown_executed=False
    data.teardown=&lt;generator object try_to_configure_proxy at 0x7fd31aeea1d0&gt;
    data.kwargs={&#39;overwrite&#39;: {&#39;proxy_port&#39;: &#39;not-a-number&#39;}}
    data.result={&#39;expected_proxy&#39;: {&#39;proxy_enabled&#39;: &#39;0&#39;, &#39;proxy_port&#39;: &#39;not-a-number&#39;, &#39;proxy_rdns&#39;: &#39;1&#39;, &#39;proxy_type&#39;: &#39;http&#39;, &#39;proxy_url&#39;: &#39;localhost&#39;, &#39;proxy_username&#39;: &#39;some_user_name&#39;, &#39;proxy_password&#39;: &#39;some_password&#39;}, &#39;error&#39;: &#39;Unexpected error &quot;&lt;class \&#39;splunktaucclib.rest_handler.error.RestError\&#39;&gt;&quot; from python handler: &quot;REST Error [400]: Bad Request -- Invalid format for numeric value&quot;. See splunkd.log/python.log for more details.&#39;, &#39;status_code&#39;: 500}
    teardown_is_blocked=False
</code></pre></div></p>
</li>
<li>
<p>Teardown post execution state (logged only if teardown was executed)
    <div class="highlight"><pre><span></span><code>2025-03-26 15:16:49.295 INFO splunk-add-on-ucc-modinput-test-functional pid=5628 tid=8606839296 file=forge.py func=dereference_teardown line=174 Teardown has been executed successfully, time taken: 0.00016307830810546875 seconds:
Teardown summary:
    data.id: 1742998608417570622,
    data.count=0,
    data.is_teardown_executed=True
    data.teardown=&lt;generator object try_to_configure_proxy at 0x7fd31aeea1d0&gt;
    data.kwargs={&#39;overwrite&#39;: {&#39;proxy_port&#39;: &#39;not-a-number&#39;}}
    data.result={&#39;expected_proxy&#39;: {&#39;proxy_enabled&#39;: &#39;0&#39;, &#39;proxy_port&#39;: &#39;not-a-number&#39;, &#39;proxy_rdns&#39;: &#39;1&#39;, &#39;proxy_type&#39;: &#39;http&#39;, &#39;proxy_url&#39;: &#39;localhost&#39;, &#39;proxy_username&#39;: &#39;some_user_name&#39;, &#39;proxy_password&#39;: &#39;some_password&#39;}, &#39;error&#39;: &#39;Unexpected error &quot;&lt;class \&#39;splunktaucclib.rest_handler.error.RestError\&#39;&gt;&quot; from python handler: &quot;REST Error [400]: Bad Request -- Invalid format for numeric value&quot;. See splunkd.log/python.log for more details.&#39;, &#39;status_code&#39;: 500}
    teardown_is_blocked=False
</code></pre></div></p>
</li>
<li>
<p>Teardown post execution state (always logged no matter if teardown was executed or postponed)
    <div class="highlight"><pre><span></span><code>2025-03-26 15:16:49.295 DEBUG splunk-add-on-ucc-modinput-test-functional pid=5628 tid=8606839296 file=forge.py func=dereference_teardown line=176 AFTER EXECUTE TEARDOWN 1742998608417570622:
Teardown summary:
    data.id: 1742998608417570622,
    data.count=0,
    data.is_teardown_executed=True
    data.teardown=&lt;generator object try_to_configure_proxy at 0x7fd31aeea1d0&gt;
    data.kwargs={&#39;overwrite&#39;: {&#39;proxy_port&#39;: &#39;not-a-number&#39;}}
    data.result={&#39;expected_proxy&#39;: {&#39;proxy_enabled&#39;: &#39;0&#39;, &#39;proxy_port&#39;: &#39;not-a-number&#39;, &#39;proxy_rdns&#39;: &#39;1&#39;, &#39;proxy_type&#39;: &#39;http&#39;, &#39;proxy_url&#39;: &#39;localhost&#39;, &#39;proxy_username&#39;: &#39;some_user_name&#39;, &#39;proxy_password&#39;: &#39;some_password&#39;}, &#39;error&#39;: &#39;Unexpected error &quot;&lt;class \&#39;splunktaucclib.rest_handler.error.RestError\&#39;&gt;&quot; from python handler: &quot;REST Error [400]: Bad Request -- Invalid format for numeric value&quot;. See splunkd.log/python.log for more details.&#39;, &#39;status_code&#39;: 500}
    teardown_is_blocked=False
</code></pre></div></p>
</li>
</ul>
</li>
</ul>
<h5 id="error-log-examples">Error log examples<a class="headerlink" href="#error-log-examples" title="Permanent link">&para;</a></h5>
<p>Note that for any error message or handled exception framework collects and logs the following information: error message itself, information about test being processed together with information about the forge being executed, attached probe, collected forge and probe arguments, stack trace. </p>
<p>When looking in the logs for an issue it&rsquo;s recommendes first to searching for <code>tracepack</code> instead of <code>error</code> - word <code>error</code> is used in data structures and can result in lots of useless matches. Many errors can be results of other errors happened earlier, so it&rsquo;s recommended to start analysis from the very first error.</p>
<ul>
<li>Example of log for forge execution fail due to missing mandatory environment variable
    <div class="highlight"><pre><span></span><code>2025-03-26 14:04:56.746 ERROR splunk-add-on-ucc-modinput-test-functional pid=16704 tid=12978290688 file=task.py func=mark_as_failed line=331 Failed to prepare forge call args: Mandatory environment variable MSCS_AZURE_ACCOUNT_CONF_ENCODED is             missing and does not have a default value specified.
test: test_canary_boostrap,
    location: .../tests/ucc_modinput_functional/test_canary.py,
    forge: vendor_canary_forge,
        location: .../tests/ucc_modinput_functional/vendor/forges/canary.py,
        scope: session,
        exec id: None,
        kwargs: {},
    probe: vendor_canary_probe,
        location: .../tests/ucc_modinput_functional/vendor/probes/canary.py,
        kwargs: {},
Traceback (most recent call last):
File &quot;.../.venv/lib/python3.7/site-packages/splunk_add_on_ucc_modinput_test/functional/executor.py&quot;, line 100, in _process_test_tasks
    self._global_builtin_args_factory(task.test_key)
File &quot;.../.venv/lib/python3.7/site-packages/splunk_add_on_ucc_modinput_test/functional/executor.py&quot;, line 207, in global_builtin_args_factory
    return self._manager.get_global_builtin_args(test_key)
File &quot;.../.venv/lib/python3.7/site-packages/splunk_add_on_ucc_modinput_test/functional/manager.py&quot;, line 190, in get_global_builtin_args
    ] = self.create_global_builtin_args()
File &quot;.../.venv/lib/python3.7/site-packages/splunk_add_on_ucc_modinput_test/functional/manager.py&quot;, line 167, in create_global_builtin_args
    v_conf_instance = v_config(self._pytest_config)
File &quot;.../.venv/lib/python3.7/site-packages/splunk_add_on_ucc_modinput_test/functional/vendor/configuration.py&quot;, line 10, in __init__
    self.customize_configuration()
File &quot;.../tests/ucc_modinput_functional/vendor/client/configuration.py&quot;, line 10, in customize_configuration
    &quot;MSCS_AZURE_ACCOUNT_CONF_ENCODED&quot;, string_function=utils.Base64.decode
File &quot;.../.venv/lib/python3.7/site-packages/splunk_add_on_ucc_modinput_test/common/utils.py&quot;, line 77, in get_from_environment_variable
    raise SplunkClientConfigurationException(error)
splunk_add_on_ucc_modinput_test.common.utils.SplunkClientConfigurationException: Mandatory environment variable MSCS_AZURE_ACCOUNT_CONF_ENCODED is             missing and does not have a default value specified.
</code></pre></div></li>
</ul>
<h4 id="log-file-ucc_modinput_testlog">Log file ucc_modinput_test.log<a class="headerlink" href="#log-file-ucc_modinput_testlog" title="Permanent link">&para;</a></h4>
<p>This is high level log that comes from the logger provided by framework in <code>splunk_add_on_ucc_modinput_test/__init__.py</code>. It&rsquo;s recommended to use this logger when log information from test, probes, forges and other code related to unified functional test implementation.</p>
<h4 id="framework-sequential-execution-mode">Framework sequential execution mode<a class="headerlink" href="#framework-sequential-execution-mode" title="Permanent link">&para;</a></h4>
<p>By default to execute forges and probes framework uses multithreading. This allows to speed up overall test execution but makes it more difficult to debug in case a forge or a probe have bugs. Sequential execution mode allows to start tests without using multithreading. All forges and probes executed sequentially which is much more easier for debugging. Sequential mode can be turned on by using <code>--sequential-execution</code> pytest custom command argument flag. When this flag is used framework ignores value of <code>--number-of-threads</code> and does not creates any threads.</p>
<h3 id="sample-issues-and-troubleshooting">Sample issues and troubleshooting<a class="headerlink" href="#sample-issues-and-troubleshooting" title="Permanent link">&para;</a></h3>
<h4 id="assertion-attempt-to-assign-the-same-forge-multiply-times-or-duplicated-test-name">Assertion &ldquo;Attempt to assign the same forge multiply times or duplicated test name&rdquo;<a class="headerlink" href="#assertion-attempt-to-assign-the-same-forge-multiply-times-or-duplicated-test-name" title="Permanent link">&para;</a></h4>
<p>This error message is logged to <code>splunk-add-on-ucc-modinput-test-functional.log</code> by test. As follows from the error message this error can be cased by two reasons:</p>
<ul>
<li>
<p>The same forge is assigned to the same tests more then once</p>
</li>
<li>
<p>There are more then one test with the same name that assigns te same forge. It sometime happens when copy-pasting tests together with assignment header. </p>
</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "navigation.indexes"], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
    
  </body>
</html>